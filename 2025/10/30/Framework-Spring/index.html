<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Spring-框架 | Arjen</title><meta name="keywords" content="Framework,Spring"><meta name="author" content="Arjen"><meta name="copyright" content="Arjen"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Spring-框架"><meta name="application-name" content="Spring-框架"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="Spring-框架"><meta property="og:url" content="http://example.com/2025/10/30/Framework-Spring/index.html"><meta property="og:site_name" content="Arjen"><meta property="og:description" content="Spring概述传统JavaWeb开发困惑及解决方案问题一：层与层之间的紧密耦合，接口与实现紧密耦合 解决思路：程序代码不需要手动new对象，第三方根据要求为程序提供需要的bean对象(工厂模式) 问题二：通用的事务功能、日志功能够合在业务代码中 解决思路：程序代码中不需要手动new对象，第三方根据"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring.png"><meta property="article:author" content="Arjen"><meta property="article:tag" content="blog"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring.png"><meta name="description" content="Spring概述传统JavaWeb开发困惑及解决方案问题一：层与层之间的紧密耦合，接口与实现紧密耦合 解决思路：程序代码不需要手动new对象，第三方根据要求为程序提供需要的bean对象(工厂模式) 问题二：通用的事务功能、日志功能够合在业务代码中 解决思路：程序代码中不需要手动new对象，第三方根据"><link rel="shortcut icon" href="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/personal/coke.png"><link rel="canonical" href="http://example.com/2025/10/30/Framework-Spring/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"下次见噜!","backTitle":"你回来啦?！"},
  LA51: undefined,
  greetingBox: undefined,
  twikooEnvId: 'https://twikoo.arjen.fun/',
  commentBarrageConfig:undefined,
  music_page_default: "nav_music",
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","📸 要成为Nikon佬","⛰️ 自然风光爱好者","🏃 脚踏实地行动派","💔 寡中寡中寡中寡","🎞️ 生活不能没电影","🎶 音乐能治愈一切"]},
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: true
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: Arjen","link":"链接: ","source":"来源: Arjen","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Arjen',
  title: 'Spring-框架',
  postAI: '',
  pageFillDescription: 'Spring概述, 传统JavaWeb开发困惑及解决方案, IoC、DI和AOP思想的提出, IoC思想, DI思想, AOP思想, Spring框架的诞生, Spring框架概述, Spring历史, Spring Framework, BeanFactory快速入门, 将一个bean对象设置到bean工厂中, 将一个bean对象设置到另一个bean中, ApplicationContext快速入门, BeanFactory与ApplicationContext的关系, BeanFactory的继承体系, ApplicationContext继承体系, 基于xml的Spring应用, SpringBean的配置详解, Bean的基础配置, Bean的别名配置, Bean的范围设置, Bean的延迟加载, Bean的初始化和销毁方法, Spring实例化的配置, 静态工厂方法实例化Bean, 实例工厂方法实例化Bean, 实现FactoryBean规范延迟实例化Bean, Bean的依赖注入配置, 集合属性注入, 自动装配, Spring的其他配置标签, Spring的get方法, Spring配置非自定义的Bean, DruidDatasource, Connection, SimpleDataFormat, SqlSessionFactory, Bean的实例化基本流程, Spring的后处理器, BeanFactoryPostProcessor, 修改BeanDefinition, 注册BeanDefinition, 完善Bean的实例化基本流程, 使用Spring的BeanDefinitionRegistryPostProcessor案例, BeanPostProcessor, 再完善Bean实例化的基本流程, SpringBean的生命周期, Bean的实例属性填充, 三级缓存, 常用的Aware接口, SpringIoC流程总结, ？Spring xml方式整合第三方框架(整合模式) P57-P66, Spring整合Mybatis, Spring整合MyBatis的原理, 基于注解的Spring应用, Bean基本注解开发, Bean依赖注入注解开发, 非自定义Bean注解开发, Bean配置类的注解开发, Spring配置其他注解, , ？Spring注解的原理解析 p76-79, ？Spring注解整合第三方框架 p80, AOP简介, AOP相关概念, AOP思想实现的方案, 模拟AOP的基础代码(动态代理), 基于xml配置的AOP, 配置详解, xml方式AOP的配置解析, AOP底层两种生成Proxy方式, jdk动态代理, Cglib动态代理, 基于注解配置的AOP, 基本使用, 配置详解,  原理解析 Spring事务编程概述 基于xml声明式事务控制, 原理剖析 p99 ？, 基于注解声明式事务控制, Spring整合web环境, javaweb三大组件及环境特点, Spring整合web环境的思路与实现概述传统开发困惑及解决方案问题一层与层之间的紧密耦合接口与实现紧密耦合解决思路程序代码不需要手动对象第三方根据要求为程序提供需要的对象工厂模式问题二通用的事务功能日志功能够合在业务代码中解决思路程序代码中不需要手动对象第三方根据要求为程序提供需要的对象的代理对象通过代理将原对象中的方法进行增强和思想的提出思想控制反转强调原来在程序中创建的权利反转给第三方思想依赖注入强调的之间的关系这种关系第三方负责设置即由容器将之间的引用关系设置好思想面向切面编程功能的横向抽取主要实现方式是框架的诞生框架概述历史快速入门将一个对象设置到工厂中配置清单是创建类的依据接口实现类此处底层通过反射拿到全包名创建对象创建一个工厂对象创建一个读取器读取配置文件给工厂根据获取实例对象强转为这里的强制类型转换是安全的因为在中类实际上是接口的一个实现类并且在配置文件中将其声明为类型因此即使实际类型是在运行时会将其视为类型这也是依赖倒置原则的体现客户端代码不应直接依赖于具体的实现类而是依赖于抽象接口总结起来强制转换为类型是为了符合面向接口编程的规范使得代码更加灵活和可维护依赖倒置原则依赖倒置原则简称是面向对象设计中的重要原则之一它主要包括以下两个核心概念高层模块不应该依赖于低层模块二者都应该依赖于抽象高层模块通常是指应用程序中的业务逻辑层低层模块是指底层的基础设施或实现细节例如在一个典型的应用中业务逻辑层不应直接依赖于具体的数据访问类例如数据库操作类而应该依赖于抽象的数据访问接口如数据访问对象接口抽象不应该依赖于细节细节应该依赖于抽象这意味着编程时应尽量针对接口或抽象类编程而不是针对具体实现编程这样做可以降低模块之间的耦合度提高代码的灵活性和可扩展性使得系统更易于维护和修改依赖倒置原则的核心思想是通过抽象来减少模块间的直接依赖关系从而提高代码的灵活性和可维护性在实际编码中我们可以通过以下方式来实现依赖倒置原则使用接口或抽象类定义模块之间的交互约定而不是直接使用具体类依赖注入通过容器如框架来管理对象之间的依赖关系将具体类的创建和管理交给容器从而降低模块之间的耦合度工厂模式通过工厂方法或抽象工厂来创建对象客户端只需要依赖工厂接口而不是具体的产品类总之依赖倒置原则是面向对象设计的一个重要指导原则它可以帮助我们编写松耦合灵活和可维护的代码提高软件系统的质量和扩展性将一个对象设置到另一个中接口实现类接口实现类调用该方法从中获取设置到此处将设置到此处测试类创建一个工厂对象创建一个读取器读取配置文件给工厂根据获取实例对象强转为根据获取实例对象强转为文件第一个代表中的方法第二个代表引用类结果将设置到此处实际上获取的是文件中对应的类并非中的类属性属性用于指定要设置的的属性名在你的配置中表示你要将一个名为的属性设置给在类中这对应于类中的一个名为的属性通常是通过方法来设置的为什么只会获取到方法而不会获取到其他方法在代码片段中定义了一个名为的它是类的实例在这段配置中通过元素为注入了一个名为的依赖对于来说它是通过反射机制来实现依赖注入的具体到配置元素中的属性指定了要实例化的类即元素中的属性指定了要调用的方法这里是方法它用来设置属性的值属性指定了依赖的名称即这表示将会在容器中查找一个名为的并将它注入到实例中的属性在中通过配置文件注入属性时使用反射来调用目标的方法并将依赖注入到目标中因此只有在配置文件中显式配置的方法才会被调用而其他方法不会被触发所以虽然你可能在类中定义了其他方法但是在这段配置中只有名为的方法被显式调用并注入了属性的值快速入门与的关系是延迟加载的调用方法时才会创建对象只要加载配置文件创建容器对象就已经创建的继承体系文件中的标签都会被封装在中的的集合中继承体系继承体系中的类根据配置容器的方式注解分为两种基于的应用的配置详解属性后期会转成的可以理解为获取的是转成的延迟加载什么时候什么时候创建对象的基础配置的别名配置设置别名后别名会出现在中的即存放别名的集合中别名会直接指向也就是配置的如果没有配置默认情况下别名第一个是如果没配置和别名那全限定名是的范围设置创建对象使用完后会销毁不会放入单例池中创建完对象会放入单例池后续仍可被使用的延迟加载对于有效对无效的初始化和销毁方法调用该方法从中获取设置到此处将设置到此处的初始化方法初始化方法的销毁方法销毁方法配置测试类关闭容器运行结果将设置到此处初始化方法销毁方法初始化方法在创建后执行销毁方法需要显示关闭容器才能执行调用该方法从中获取设置到此处将设置到此处的初始化方法初始化方法的销毁方法销毁方法方法执行运行结果将设置到此处方法执行初始化方法销毁方法方法在属性设置后在初始化方法执行前执行实例化的配置就是工厂工厂内部创建时又分为两种方式当使用工厂方式实例化时工厂内部的方法需要自定义静态工厂方法实例化返回的实现类交给容器管理类可以再创建之前执行一些其他业务逻辑当采用此方法配置的时候容器解析时与不同的是不是将变为对象而是去寻找这个类中的方法为把方法的返回值当做对象再以指定的作为放入容器中区别静态方法不需要创建工厂对象直接通过工厂名方法名创建对象体现在配置中实例工厂方法实例化返回的实现类交给容器管理类可以再创建之前执行一些其他业务逻辑实例工厂实例工厂先配置工厂对象再去配置实例工厂的方法的返回值注意需要先配置工厂对象再去配置工厂对象调用的方法如果工厂方法有参数通过来配置方法的参数返回的实现类交给容器管理类可以再创建之前执行一些其他业务逻辑实例工厂配置通过来配置方法的参数实现规范延迟实例化底层用的多是一个接口主要用于定义工厂的规范换言之就是给自定义工厂制定了一套标准实现这个接口就相当于使用了这套标准方法名不再是自定义使用这套标准后就不需要在文件中配置接口源码返回一个泛型为的对象返回当前的类型是否单例例测试类实现规范实例化实现接口的类文件采用实现接口规范实例化运行结果静态工厂实例工厂出现其他非相关信息是因为在文件中配置了其他的实现只要测试类读取配置文件就会创建到容器中所以其他中的内容也会被执行但是其他的对象需要再才能得到执行完后底层单例池中存放的是工厂对象不是对象但控制台仍然输出的是对象的地址而对象存放在当真正调用这个的时候也就是的时候才会把这个实例化的对象返回也就是才会调用实现接口中的方法才会放入缓存当中当下一次调用从缓存当中取出注意区分和区别角色与作用是容器的基础接口负责管理和控制的生命周期包括实例化依赖注入初始化销毁等是一个特殊的实现了接口的类负责生产其他的实例允许在实例化过程中进行更多的控制和定制功能差异提供了核心的管理功能它是一个工厂接口可以管理和获取各种类型的实例提供了一种扩展机制允许开发者自定义复杂的实例化逻辑它本身也是一个但其方法返回的不是它自身而是它管理的另一个的实例实现方式是一个接口定义了容器的基础功能由各种具体实现类如来实现是一个具体的类实现了接口开发者需要通过实现该接口来自定义的创建过程联系是的容器作为容器的基础接口它可以管理和控制实例实例本身也是由管理的一种特殊的可以定制的创建逻辑接口的存在允许开发者在实例化的过程中进行更多的控制和定制例如根据条件动态创建不同的实例或者通过复杂的逻辑来决定的初始化参数使用场景使用管理和获取标准的实例适用于大多数的管理场景使用适用于需要复杂逻辑或者定制化配置的创建场景例如动态代理条件化的创建等总结来说是容器的基础接口负责管理和控制的生命周期而是一个特殊的负责生产其他的实例可以在实例化过程中进行更多的控制和定制它们在应用中扮演了不同但互补的角色的依赖注入配置集合属性注入为集合注入属性集合对象设置属性提供方法文件注入集合属性和对象集合配置引用测试类注入集合自动装配以上均为手动装配中的方法方法名去掉其余部分首字母小写与文件中的相同创建接口和实现类配置文件测试代码自动装配的其他配置标签测试类开发环境测试环境指定环境文件开发环境测试环境文件中除了指定了环境的部分配置生效以外公共部分也会生效导入配置文件起别名引入外部标签在文件中导入坐标在配置文件中的命名空间中引入配置映射地址的方法在框架中通常推荐通过接口来获取对象而不是直接使用实现类这样做有几个好处解耦合通过接口获取可以将组件之间的耦合度降低如果后续需要替换实现类只需修改配置文件或者注解即可而不需要修改调用方的代码动态代理在注入的时候通常会使用动态代理如果你直接通过实现类获取可能会得到一个代理对象而不是原始的实现类对象因此通过接口获取可以确保你得到的是管理的正确的代理对象更易于测试在单元测试中你可以通过模拟实现类的方式来替代真实的这样可以更方便地进行测试如果直接使用实现类可能需要进行更多的设置和清理工作具体到你的代码片段假设是一个接口这样做就是为了遵循面向接口编程的最佳实践在运行时会根据配置文件或者注解自动选择合适的实现类来实例化并返回给你总结来说通过接口获取是一种良好的编程习惯能够提升代码的灵活性可维护性和可测试性配置非自定义的非自定义第三方某些包中的对象交给容器管理导入坐标在配置文件中配置相关属性普通创建对象的方法将对象交给容器管理测试类的实例化基本流程其中有一个是维护类的全限定名用于反射去创建对象内部存储的的定义信息源码源码基本流程概括的后处理器实例化属性赋值前置处理初始化后置处理使用修改自定义类实现该接口再将该类交给容器管理自定义类实现接口当完成填充后回调该方法修改在实例化之前改变设置的全限定名改变测试类配置文件运行结果当完成填充后回调该方法设置的全限定名改变发现的名字是但是的变成了存疑乌龙中注册的全限定名写错了当将也配置进文件中会发现中的内容是的而中的内容是的也就是中的内容发生了自动变换两个都进行了创建出现在了单例池中自定义类实现接口当完成填充后回调该方法修改在实例化之前改变设置的全限定名改变测试类配置文件运行结果当完成填充后回调该方法方法执行注册不需要在文件中配置通过工厂后处理器同样可以完成实例化自定义类实现接口当完成填充后回调该方法注册使用接口的实现强转成内部维护的方法多为了使用方法注册将放入到中测试类后处理器注册除了以上方式外提供了专门注册的接口源码完善的实例化基本流程使用的案例创建类实现将注册通过扫描工具去扫描指定包及其子包下的所有类收集使用了注解的类遍历组装进行注册反射获得创建注册类扫描工具扫描注解设置资源规则创建容器存储使用了指定注解的字节码对象工具类可以获取指定路径下的全部类的工厂类用于读取类信息扫描到的判断是否属于指定的注解类型获得注解对象获得属属性值判断是否为存储到中去如果没有为那就把当前类的类名作为测试类自定义注解运行结果测试类文件运行结果由此可以得知当在中配置了并将后处理器同样配置到当中容器会自动在的初始化过程中将后处理器中的方法加入到中不论配置几个在框架中后处理器是一种特殊类型的它允许在容器实例化并在依赖注入发生之前或之后执行自定义的初始化和销毁逻辑后处理器需要在容器中显式配置并且其实例化和初始化过程是由容器管理的如果在配置文件中将后处理器配置为一个并将其注册到容器中那么容器在实例化和初始化其他普通时会自动检测是否存在注册的后处理器如果存在容器会将该后处理器应用于容器中所有符合条件的具体来说在配置文件中配置后处理器时需要使用元素来定义该后处理器的容器会自动检测实现了接口的并将其应用于容器中的所有后处理器的主要方法是和分别在的初始化前后调用允许开发者执行额外的逻辑操作因此无论你在配置中有多少个普通只要你配置了相应的后处理器并且将其注册到容器中会确保在所有符合条件的的初始化过程中调用该后处理器的方法这确保了你可以在初始化前后进行自定义的操作而不需要显式地在每个的配置中添加额外的初始化逻辑实例化过程中方法的执行顺序如下再完善实例化的基本流程的生命周期的实例属性填充执行流程虽然是半成品但是可以先把这个半成品设置为自己的属性后面再往这个半成品里填东西也就是把这个半成品补全三级缓存一级缓存二级缓存三级缓存一般情况下三级缓存存储的是未被引用过的半成品二级缓存存储的是已经被引用的半成品二级缓存用于存储被引用的对象如果没被引用直接会从三到一不走二三级缓存源码剖析流程实例化将的对象存入到三级缓存中在三级缓存中寻找放入二级缓存常用的接口流程总结以下内容尚未完善方式整合第三方框架整合模式整合原始写法加载配置文件创建对象这段代码是使用进行数据库操作的一个示例让我们逐步解释每一行代码的作用这一行通过提供的类加载名为的配置文件返回一个对象这个配置文件通常包含了数据库连接信息映射器配置等创建一个对象是用来创建的构建器使用构建对象是的核心接口之一负责创建对象从而与数据库进行交互通过创建一个对象提供了执行命令获取映射器等操作的方法通过的方法获取一个接口的实现类实例是一个由根据配置和接口生成的映射器接口用于执行数据库操作调用的方法这个方法可能是在接口中定义的用于查询数据库并返回一个即购买记录列表总结一下这段代码的主要流程是加载的配置文件创建并配置它是的核心接口用于创建数据库会话通过获取映射器并使用执行数据库操作这里是获取所有购买记录的列表这种方式利用了的对象关系映射能力将数据库操作封装在映射器接口中使得代码更加模块化和易于维护整合导入依赖坐标编写和配置和实现了的接口主要作用是提供可以替代整合的原理基于注解的应用基本注解开发开启注解组件扫描扫描指定包及其子包下的类识别使用使用注解将对象实例化并以指定的名字存储到容器当中若注解未指定默认为类名且首字母小写除此以外的三层架构中其他类使用注解标注依赖注入注解开发一般用于读取配置文件的属性更具类型进行注入如果统一类型的有多个尝试根据名字进行二次匹配匹配不成功则注入失败可以和结合一起使用作用是根据名称注入相应的也可以单独使用注入方法的参数不指定名称参数的时候根据类型注入指定名称就根据名称注入非自定义注解开发在方法参数的属性注入对象引用按照类型注入可以直接注入省略配置类的注解开发当使用注解去配置配置文件需要更换加载配置文件的方式同样也可以引入其他配置类到核心配置类当中标记的接口不是由管理的但是可以在管理的层中通过注解获取到生成的接口的代理对象从而在层中使用的方法来操作数据库配置其他注解以下内容未完善注解的原理解析注解整合第三方框架简介相关概念思想实现的方案模拟的基础代码动态代理增强前置方法增强后置方法目的对中的方法进行增强增强方法在中问题如何筛选包下的所有类的所有方法都可以增强解决方案问题怎么获取到解决方案从容器中区获取方法生成当前的对象类加载器接口执行增强对象的方法执行目标对象的方法参数目标对象目标对象方法参数执行增强对象的方法返回对象的返回值如果进不了则原封不动的返回实现接口以获取注入到的对象实例将目标对象交给容器管理再通过后处理器将中的方法增强使用动态代理将增强对象的方法给目标对象增强其中的关键点增强对象再文件中配置通过实现接口来回调注入到中对象基于配置的修改命名空间注解配置目标对象增强对象配置配置切点表达式目的是指定哪些方法要被增强配置织入目的是将目标方法与增强方法织入类配置实现调用目标对象的方法配置详解方式的配置解析首先进行自定义命名空间解析然后为标签制定一个解析器解析器只做一件事往容器中注入一个而它的本质是一个在对应的方法中生成的代理对象的动作最终把代理对象存储到容器当中简言之是一个生成的的过程底层两种生成方式动态代理怎么理解动态代理技术目标类有接口基于接口动态生成实现类的代理对象动态代理技术是中一种利用反射机制在运行时动态生成代理类的技术它基于目标类实现的接口来创建代理对象主要通过以下步骤实现定义接口首先你需要定义一个接口这个接口是目标类实现的接口例如编写目标类编写实现了该接口的目标类例如实现接口创建一个实现了接口的类这个类中实现代理对象的具体操作逻辑例如创建代理对象使用类的方法动态地创建代理对象这个方法接受一个类加载器一个接口数组和一个实例作为参数返回一个实现了指定接口的代理对象例如在上述例子中方法根据传入的接口数组和实例动态地生成了一个实现了接口的代理对象当调用的方法时实际会调用中的方法在方法调用前后可以执行额外的逻辑例如日志记录权限检查等总结来说动态代理技术利用的反射机制在运行时动态生成一个实现了指定接口的代理类对象从而可以在方法调用前后插入一些通用逻辑而不需要修改原始类的代码生成的在某种意义上可以看作是接口的实现类虽然它并不是你手动编写的典型意义上的实现类但它确实实现了接口定义的所有方法在使用动态代理时你通过方法传入了一个接口数组和一个实例在运行时会动态生成一个代理类这个代理类实现了这些接口并且在方法调用时会委托给实现中的方法处理具体的逻辑因此虽然在代码中你没有显式地编写一个类声明但动态代理技术使得在运行时生成了一个实现了接口的类这个类就是通过生成的对象动态代理基于父类目标类生成目标对象通知对象编写的代码创建增强器对象增强器设置父类生成的代理对象就是的子类设置回调相当于的的方法前置通知执行目标方法后置通知生成代理对象测试基于注解配置的基本使用属性时前置通知增强的目标对象方法的位置配置详解切点表达式的抽取配置核心配置类解析核心配置类创建容器原理解析事务编程概述基于声明式事务控制以下内容尚未完善原理剖析基于注解声明式事务控制全注解配置将文件中的所有配置全部配置到核心类中更换解析方式整合环境三大组件及环境特点整合环境的思路与实现监听域的创建',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-10-30 10:30:30',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/personal/avatar.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://earth.nullschool.net/zh-cn" title="earth"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="earth"/><span class="back-menu-item-text">earth</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://bongo.cat/" title="敲鼓喵"><img class="back-menu-item-icon" alt="敲鼓喵"/><span class="back-menu-item-text">敲鼓喵</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://drawafish.com/" title="DrawAFish"><img class="back-menu-item-icon" alt="DrawAFish"/><span class="back-menu-item-text">DrawAFish</span></a><a class="back-menu-item" href="/" title="陆续添加中..."><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="陆续添加中..."/><span class="back-menu-item-text">陆续添加中...</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">Arjen</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 全部</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=9586170740&amp;server=tencent"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png" target="_blank"><img class="post-qr-code-img" alt="微信" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-weichat.png"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/API/" style="font-size: 1.05rem;">API<sup>1</sup></a><a href="/tags/Collection/" style="font-size: 1.05rem;">Collection<sup>1</sup></a><a href="/tags/Exception/" style="font-size: 1.05rem;">Exception<sup>1</sup></a><a href="/tags/File/" style="font-size: 1.05rem;">File<sup>1</sup></a><a href="/tags/Framework/" style="font-size: 1.05rem;">Framework<sup>1</sup></a><a href="/tags/IO/" style="font-size: 1.05rem;">IO<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 1.05rem;">JAVA<sup>13</sup></a><a href="/tags/Lambda/" style="font-size: 1.05rem;">Lambda<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 1.05rem;">Spring<sup>1</sup></a><a href="/tags/Stream/" style="font-size: 1.05rem;">Stream<sup>1</sup></a><a href="/tags/Thread/" style="font-size: 1.05rem;">Thread<sup>1</sup></a><a href="/tags/Thread%E6%89%A9%E5%B1%95/" style="font-size: 1.05rem;">Thread扩展<sup>1</sup></a><a href="/tags/%E4%B9%A6%E6%91%98/" style="font-size: 1.05rem;">书摘<sup>1</sup></a><a href="/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" style="font-size: 1.05rem;">动态代理<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size: 1.05rem;">反射<sup>1</sup></a><a href="/tags/%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8/" style="font-size: 1.05rem;">方法引用<sup>1</sup></a><a href="/tags/%E7%97%85%E9%9A%99%E7%A2%8E%E7%AC%94/" style="font-size: 1.05rem;">病隙碎笔<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 1.05rem;">网络编程<sup>1</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">11</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%A1%86%E6%9E%B6/" itemprop="url">框架</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/Framework/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Framework</span></a><a class="article-meta__tags" href="/tags/Spring/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>Spring</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Spring-框架</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-10-30T02:12:41.000Z" title="发表于 2025-10-30 10:12:41">2025-10-30</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-10-30T02:30:30.747Z" title="更新于 2025-10-30 10:30:30">2025-10-30</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">12k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>51分钟</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="Spring-框架"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为内蒙古"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>内蒙古</span><span class="post-meta-separator"></span><span class="post-meta-commentcount"><i class="anzhiyufont anzhiyu-icon-comments post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/2025/10/30/Framework-Spring/#post-comment" tabindex="-1"><span id="twikoo-count"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></a></span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="http://example.com/2025/10/30/Framework-Spring/"><header><a class="post-meta-categories" href="/categories/%E6%A1%86%E6%9E%B6/" itemprop="url">框架</a><a href="/tags/Framework/" tabindex="-1" itemprop="url">Framework</a><a href="/tags/Spring/" tabindex="-1" itemprop="url">Spring</a><h1 id="CrawlerTitle" itemprop="name headline">Spring-框架</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">Arjen</span><time itemprop="dateCreated datePublished" datetime="2025-10-30T02:12:41.000Z" title="发表于 2025-10-30 10:12:41">2025-10-30</time><time itemprop="dateCreated datePublished" datetime="2025-10-30T02:30:30.747Z" title="更新于 2025-10-30 10:30:30">2025-10-30</time></header><h1 id="Spring概述"><a href="#Spring概述" class="headerlink" title="Spring概述"></a>Spring概述</h1><h2 id="传统JavaWeb开发困惑及解决方案"><a href="#传统JavaWeb开发困惑及解决方案" class="headerlink" title="传统JavaWeb开发困惑及解决方案"></a>传统JavaWeb开发困惑及解决方案</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721665199756-467ec9ca-b9e6-4801-83ee-66ea20495b98.png"><br>问题一：层与层之间的紧密耦合，接口与实现紧密耦合</p>
<p>解决思路：程序代码不需要手动new对象，第三方根据要求为程序提供需要的bean对象(工厂模式)</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721664754967-42021075-4100-4905-8726-c94cc4f5aa67.png"><br>问题二：通用的事务功能、日志功能够合在业务代码中</p>
<p>解决思路：程序代码中不需要手动new对象，第三方根据要求为程序提供需要的bean对象的代理对象，通过代理将原对象中的方法进行增强</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721665120016-690f327d-a405-4f72-b126-88160b3d0247.png"></p>
<h2 id="IoC、DI和AOP思想的提出"><a href="#IoC、DI和AOP思想的提出" class="headerlink" title="IoC、DI和AOP思想的提出"></a>IoC、DI和AOP思想的提出</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721666238093-32ede848-dbd6-475a-802f-ee4e719ad237.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721666299762-4c3b12e4-0323-4df9-8b2c-08fd7935da72.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721665716835-dd99eca4-2239-4dba-a4a1-e7608e2c6bd0.png"></p>
<h3 id="IoC思想"><a href="#IoC思想" class="headerlink" title="IoC思想"></a>IoC思想</h3><p>Inversion of Control,控制反转，强调原来在程序中创建Bean的权利反转给第三方</p>
<h3 id="DI思想"><a href="#DI思想" class="headerlink" title="DI思想"></a>DI思想</h3><p>Dependency Injection，依赖注入，强调的Bean之间的关系，这种关系第三方负责设置，即由容器将Bean之间的引用关系设置好</p>
<h3 id="AOP思想"><a href="#AOP思想" class="headerlink" title="AOP思想"></a>AOP思想</h3><p>Aspect Oriented Programming，面向切面编程，功能的横向抽取，主要实现方式是Proxy</p>
<h2 id="Spring框架的诞生"><a href="#Spring框架的诞生" class="headerlink" title="Spring框架的诞生"></a>Spring框架的诞生</h2><h3 id="Spring框架概述"><a href="#Spring框架概述" class="headerlink" title="Spring框架概述"></a>Spring框架概述</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721666410442-2c2f9f68-138b-441b-9a0f-2b43818a55d8.png"></p>
<h3 id="Spring历史"><a href="#Spring历史" class="headerlink" title="Spring历史"></a>Spring历史</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721666647870-2d81f4b0-a662-4ab1-ac23-a431e0dab942.png"></p>
<h3 id="Spring-Framework"><a href="#Spring-Framework" class="headerlink" title="Spring Framework"></a>Spring Framework</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721666849954-b6ee8b86-f53d-4583-b04c-740e39fed06c.png"></p>
<h3 id="BeanFactory快速入门"><a href="#BeanFactory快速入门" class="headerlink" title="BeanFactory快速入门"></a>BeanFactory快速入门</h3><h4 id="将一个bean对象设置到bean工厂中"><a href="#将一个bean对象设置到bean工厂中" class="headerlink" title="将一个bean对象设置到bean工厂中"></a>将一个bean对象设置到bean工厂中</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721666931449-69515e28-0500-4e89-a3a2-65ccb0a57788.png"><br>配置清单是BeanFactory创建Bean类的依据</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721667121013-d910f6e3-df1b-40bb-8e15-d13823b456f9.png"></p>
<p>1. </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.3.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span>  <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>此处底层通过反射拿到全包名，创建对象</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.jackey.service.Impl.UserServiceImpl&quot;</span>&gt;&lt;/bean&gt;</span><br></pre></td></tr></table></figure>

<p>4. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeansFactoryTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个工厂对象</span></span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">        <span class="comment">//创建一个读取器（xml）</span></span><br><span class="line">        XmlBeanDefinitionReader reader= <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line">        <span class="comment">//读取配置文件给工厂</span></span><br><span class="line">        reader.loadBeanDefinitions(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//根据id获取Bean实例对象 强转为UserService</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>这里的强制类型转换是安全的，因为在 Spring 中，UserServiceImpl 类实际上是 UserService 接口的一个实现类，并且 Spring 在配置文件中将其声明为 UserService 类型。因此，即使实际类型是 UserServiceImpl，Spring 在运行时会将其视为 UserService 类型，这也是依赖倒置原则的体现，客户端代码不应直接依赖于具体的实现类，而是依赖于抽象接口。</strong></p>
<p><strong>总结起来，强制转换为 UserService 类型是为了符合面向接口编程的规范，使得代码更加灵活和可维护。</strong></p>
<hr>
<p><strong>依赖倒置原则</strong></p>
<p>依赖倒置原则（Dependency Inversion Principle，简称DIP）是面向对象设计中的重要原则之一，它主要包括以下两个核心概念：</p>
<ol>
<li><strong>高层模块不应该依赖于低层模块，二者都应该依赖于抽象。</strong><ul>
<li>高层模块通常是指应用程序中的业务逻辑层，低层模块是指底层的基础设施或实现细节。</li>
<li>例如，在一个典型的应用中，业务逻辑层不应直接依赖于具体的数据访问类（例如数据库操作类），而应该依赖于抽象的数据访问接口（如数据访问对象接口）。</li>
</ul>
</li>
<li><strong>抽象不应该依赖于细节，细节应该依赖于抽象。</strong><ul>
<li>这意味着编程时应尽量针对接口或抽象类编程，而不是针对具体实现编程。</li>
<li>这样做可以降低模块之间的耦合度，提高代码的灵活性和可扩展性，使得系统更易于维护和修改。</li>
</ul>
</li>
</ol>
<p>依赖倒置原则的核心思想是通过抽象来减少模块间的直接依赖关系，从而提高代码的灵活性和可维护性。在实际编码中，我们可以通过以下方式来实现依赖倒置原则：</p>
<ul>
<li><strong>使用接口或抽象类</strong>：定义模块之间的交互约定，而不是直接使用具体类。</li>
<li><strong>依赖注入（Dependency Injection，DI）</strong>：通过容器（如Spring框架）来管理对象之间的依赖关系，将具体类的创建和管理交给容器，从而降低模块之间的耦合度。</li>
<li><strong>工厂模式</strong>：通过工厂方法或抽象工厂来创建对象，客户端只需要依赖工厂接口，而不是具体的产品类。</li>
</ul>
<p>总之，依赖倒置原则是面向对象设计的一个重要指导原则，它可以帮助我们编写松耦合、灵活和可维护的代码，提高软件系统的质量和扩展性。</p>
<h4 id="将一个bean对象设置到另一个bean中"><a href="#将一个bean对象设置到另一个bean中" class="headerlink" title="将一个bean对象设置到另一个bean中"></a>将一个bean对象设置到另一个bean中</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//接口</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.dao;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.Impl.UserServiceImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//接口 </span></span><br><span class="line"><span class="keyword">package</span> com.jackey.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span>  <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//BeanFactory调用该方法，从BeanFactory中获取sserDao设置到此处</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">        System.out.println(<span class="string">&quot;将userDao设置到此处&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UserServiceImpl&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userDao=&quot;</span> + userDao +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.DefaultListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.xml.XmlBeanDefinitionReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeansFactoryTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">//创建一个工厂对象</span></span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">        <span class="comment">//创建一个读取器（xml）</span></span><br><span class="line">        XmlBeanDefinitionReader reader= <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line">        <span class="comment">//读取配置文件给工厂</span></span><br><span class="line">        reader.loadBeanDefinitions(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据id获取Bean实例对象 强转为UserService</span></span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) beanFactory.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据id获取Bean实例对象 强转为UserDao</span></span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao</span> <span class="operator">=</span> (UserDao) beanFactory.getBean(<span class="string">&quot;userDao&quot;</span>);</span><br><span class="line">        System.out.println(userDao);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xml文件</span></span><br><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.jackey.service.Impl.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line"><span class="comment">// 第一个userDao 代表UserServiceImpl中的setter方法setUserDao </span></span><br><span class="line"><span class="comment">// 第二个userDao 代表引用UserDao类</span></span><br><span class="line">&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.jackey.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">结果</span></span><br><span class="line"><span class="comment">将userDao设置到此处</span></span><br><span class="line"><span class="comment">UserServiceImpl&#123;userDao=com.jackey.dao.impl.UserDaoImpl@42d3bd8b&#125;</span></span><br><span class="line"><span class="comment">com.jackey.dao.impl.UserDaoImpl@42d3bd8b</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>getBean：</strong></p>
<p>实际上获取的是xml文件中id对应的类，并非getBean()中的类</p>
<p><strong>name属性</strong>:</p>
<p>name 属性用于指定要设置的 bean 的属性名。在你的配置中，name&#x3D;”userDao” 表示你要将一个名为 userDao 的属性设置给 userService bean。</p>
<p>在 Java 类中，这对应于 UserServiceImpl 类中的一个名为 userDao 的属性（通常是通过setter方法来设置的）。</p>
<p><strong>为什么只会获取到setter方法，而不会获取到其他方法</strong></p>
<p>在代码片段中，定义了一个名为 userService的 Spring Bean，它是 <code>UserServiceImpl</code> 类的实例。在这段配置中，通过 <property>元素为 userService注入了一个名为 userDao的依赖。</p>
<p>对于 Spring Framework 来说，它是通过反射机制来实现依赖注入的。具体到配置：</p>
<ol>
<li><p><bean> 元素中的 class属性指定了要实例化的类，即 UserServiceImpl。</p>
</li>
<li><p><property>元素中的 name属性指定了要调用的 setter 方法，这里是 setUserDao方法，它用来设置 userDao 属性的值。</p>
</li>
<li><p>ref 属性指定了依赖的 Bean 名称，即 userDao，这表示 Spring 将会在容器中查找一个名为 userDao 的 Bean，并将它注入到 UserServiceImpl 实例中的 userDao 属性。</p>
</li>
</ol>
<p>在 Spring 中，通过 XML 配置文件注入属性时，Spring 使用 Java 反射来调用目标 Bean 的 setter 方法，并将依赖注入到目标 Bean 中。因此，只有在 XML 配置文件中显式配置的 setter 方法才会被调用，而其他方法不会被触发。</p>
<p>所以，虽然你可能在 UserServiceImpl 类中定义了其他方法，但是在这段配置中，只有名为 setUserDao的 setter 方法被显式调用并注入了 userDao 属性的值。</p>
<h3 id="ApplicationContext快速入门"><a href="#ApplicationContext快速入门" class="headerlink" title="ApplicationContext快速入门"></a>ApplicationContext快速入门</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721751777137-400e913c-7f00-4142-b077-b54303ee5b89.png"></p>
<h3 id="BeanFactory与ApplicationContext的关系"><a href="#BeanFactory与ApplicationContext的关系" class="headerlink" title="BeanFactory与ApplicationContext的关系"></a>BeanFactory与ApplicationContext的关系</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721817628059-6ab2d4cb-a1f4-40a7-aff1-c7c2e831274b.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721817923538-ce3d6888-aff2-4546-be06-99ddecc73da6.png"><strong>BeanFactory是延迟加载的，调用getBean方法时才会创建Bean对象</strong></p>
<p><strong>ApplicationContext只要加载配置文件、创建容器，Bean对象就已经创建</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721819010954-82ad9718-a894-4aa9-9c5e-2e69a5e205bc.png"></p>
<h3 id="BeanFactory的继承体系"><a href="#BeanFactory的继承体系" class="headerlink" title="BeanFactory的继承体系"></a>BeanFactory的继承体系</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721829530646-4669b64e-e6c6-4a7e-802a-ebf29bc207e1.png"><br>xml文件中的<bean>标签都会被封装在DefaultListableBeanFactory中的beanDefinitionMap的map集合中</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, BeanDefinition&gt; beanDefinitionMap;</span><br></pre></td></tr></table></figure>

<h3 id="ApplicationContext继承体系"><a href="#ApplicationContext继承体系" class="headerlink" title="ApplicationContext继承体系"></a>ApplicationContext继承体系</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721830215127-4d396f0c-71e2-4d75-87b3-0513299594d5.png"><br><strong>继承体系中的类根据配置Spring容器的方式(注解、xml)分为两种</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721830421645-e54ef9a8-84ea-43cc-aa1d-9c0fc9bdbc4e.png"></p>
<h1 id="基于xml的Spring应用"><a href="#基于xml的Spring应用" class="headerlink" title="基于xml的Spring应用"></a>基于xml的Spring应用</h1><h2 id="SpringBean的配置详解"><a href="#SpringBean的配置详解" class="headerlink" title="SpringBean的配置详解"></a>SpringBean的配置详解</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721832090257-36e1a784-d424-4586-8fff-1c746f810fa4.png"><br>id属性后期会转成Bean的name，可以理解为getBean(id)获取的是id转成的name</p>
<p>lazy-init延迟加载，什么时候getBean什么时候创建Bean对象</p>
<h3 id="Bean的基础配置"><a href="#Bean的基础配置" class="headerlink" title="Bean的基础配置"></a>Bean的基础配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721836353796-7abe000c-490a-43fe-ace3-04228d792186.png"></p>
<h3 id="Bean的别名配置"><a href="#Bean的别名配置" class="headerlink" title="Bean的别名配置"></a>Bean的别名配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721837472689-0e774e36-060a-49e0-89d7-b801b916d34d.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721837214927-5d9a08f8-6b35-43f7-b9cf-e898d4d5ab24.png"><br><strong>设置别名后，别名会出现在singleObjects中的aliasMap，即存放别名的Map集合中，别名会直接指向Beanname也就是配置的Beanid，如果没有配置Beanid，默认情况下，别名name(aaa bbb ccc)第一个是Beanname(aaa)，如果没配置beanid 和别名name，那全限定名是Beanname</strong></p>
<h3 id="Bean的范围设置"><a href="#Bean的范围设置" class="headerlink" title="Bean的范围设置"></a>Bean的范围设置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721975567857-a2d4b466-c15f-4b9b-8be2-c4548197040a.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721976107577-709050cb-029a-45d4-aba7-647c2a68e3df.png"><br>prototype创建Bean对象，使用完后会销毁，不会放入单例池中，singleton创建完Bean对象会放入单例池，后续仍可被使用</p>
<h3 id="Bean的延迟加载"><a href="#Bean的延迟加载" class="headerlink" title="Bean的延迟加载"></a>Bean的延迟加载</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721977077202-102ec6f7-057a-42c7-b6fd-0b70852a9516.png"><br>对于ApplicationContext有效，对BeanFactory无效</p>
<h3 id="Bean的初始化和销毁方法"><a href="#Bean的初始化和销毁方法" class="headerlink" title="Bean的初始化和销毁方法"></a>Bean的初始化和销毁方法</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1721981633702-9884c9eb-a73e-42c3-b3f6-405af8c3b908.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//BeanFactory调用该方法，从BeanFactory中获取sserDao设置到此处</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">        System.out.println(<span class="string">&quot;将userDao设置到此处&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Bean的初始化方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Bean的销毁方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;销毁方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UserServiceImpl&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userDao=&quot;</span> + userDao +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//xml配置</span></span><br><span class="line">&lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;com.jackey.service.Impl.UserServiceImpl&quot;</span> init-method=<span class="string">&quot;init&quot;</span> destroy-method=<span class="string">&quot;destroy&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>&gt;&lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beans.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> (UserService) applicationContext.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line">        applicationContext.close(); <span class="comment">//关闭容器</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将userDao设置到此处</span></span><br><span class="line"><span class="comment">初始化方法...</span></span><br><span class="line"><span class="comment">UserServiceImpl&#123;userDao=com.jackey.dao.impl.UserDaoImpl@6fc6f14e&#125;</span></span><br><span class="line"><span class="comment">销毁方法...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<pre><code>**初始化方法在Bean创建后执行，销毁方法需要显示关闭容器才能执行**
</code></pre>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722005705543-3748194e-cb84-466e-84bc-b2964fe0cf26.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.service.Impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> , InitializingBean &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserDao userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//BeanFactory调用该方法，从BeanFactory中获取sserDao设置到此处</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDao userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">        System.out.println(<span class="string">&quot;将userDao设置到此处&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Bean的初始化方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//Bean的销毁方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;销毁方法...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;UserServiceImpl&#123;&quot;</span> +</span><br><span class="line">                <span class="string">&quot;userDao=&quot;</span> + userDao +</span><br><span class="line">                <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterPropertiesSet方法执行&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">将userDao设置到此处</span></span><br><span class="line"><span class="comment">afterPropertiesSet方法执行</span></span><br><span class="line"><span class="comment">初始化方法...</span></span><br><span class="line"><span class="comment">UserServiceImpl&#123;userDao=com.jackey.dao.impl.UserDaoImpl@56235b8e&#125;</span></span><br><span class="line"><span class="comment">销毁方法...</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>afterPropertiesSet方法在属性设置后，在初始化方法执行前执行</strong></p>
<h3 id="Spring实例化的配置"><a href="#Spring实例化的配置" class="headerlink" title="Spring实例化的配置"></a>Spring实例化的配置</h3><p>BeanFactory就是工厂，工厂内部创建Bean时又分为两种方式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722007198844-10d65ad3-2115-4b0f-8e4c-436277a5b517.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722007659609-c9a8c087-108a-4f55-9ceb-6998779d7cad.png"><br><strong>当使用工厂方式实例化时，工厂内部的方法需要自定义</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722007847956-1ad25be0-6731-4473-b7a1-9427fa25deaf.png"></p>
<h4 id="静态工厂方法实例化Bean"><a href="#静态工厂方法实例化Bean" class="headerlink" title="静态工厂方法实例化Bean"></a>静态工厂方法实例化Bean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.impl.UserDaoImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticMethodBeanFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> UserDao <span class="title function_">setUserDao</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//返回userDao的实现类 交给Spring容器管理类</span></span><br><span class="line">        <span class="comment">//可以再bean创建之前执行一些其他业务逻辑</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao1</span> <span class="operator">=</span> (UserDao) applicationContext.getBean(<span class="string">&quot;userDao1&quot;</span>);</span><br><span class="line">        System.out.println(userDao1);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//&lt;bean id=&quot;userDao1&quot; class=&quot;com.jackey.factory.StaticMethodBeanFactory&quot; factory-method=&quot;setUserDao&quot;&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">// 当采用此方法配置的时候，Spring容器解析时，与BeanFactory不同的是 不是将StaticMethodBeanFactory变为对象 ，</span></span><br><span class="line"><span class="comment">//而是去寻找这个类中的方法为setUserDao，把方法的返回值当做对象，再以指定的id作为beanname放入容器中</span></span><br></pre></td></tr></table></figure>

<p><strong>区别：静态方法不需要创建工厂对象，直接通过工厂名.方法名创建bean对象（体现在xml配置中）</strong></p>
<h4 id="实例工厂方法实例化Bean"><a href="#实例工厂方法实例化Bean" class="headerlink" title="实例工厂方法实例化Bean"></a>实例工厂方法实例化Bean</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.impl.UserDaoImpl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodBeanFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> UserDao <span class="title function_">setUserDao</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">//返回userDao的实现类 交给Spring容器管理类</span></span><br><span class="line">        <span class="comment">//可以再bean创建之前执行一些其他业务逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;实例工厂&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 实例工厂</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao2</span> <span class="operator">=</span> (UserDao) applicationContext2.getBean(<span class="string">&quot;userDao2&quot;</span>);</span><br><span class="line">        System.out.println(userDao2);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&lt;!--    先配置工厂对象--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;MyBeanFactory&quot;</span> class=<span class="string">&quot;com.jackey.factory.MethodBeanFactory&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">&lt;!--    再去配置实例工厂的方法的返回值--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userDao2&quot;</span> factory-bean=<span class="string">&quot;MyBeanFactory&quot;</span> factory-method=<span class="string">&quot;setUserDao&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<pre><code>**注意需要先配置工厂对象 再去配置工厂对象调用的方法**
</code></pre>
<p>如果工厂方法有参数，通过constructor-arg来配置方法的参数</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MethodBeanFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> UserDao <span class="title function_">setUserDao</span><span class="params">(String name, <span class="type">int</span> age)</span>&#123;</span><br><span class="line">        <span class="comment">//返回userDao的实现类 交给Spring容器管理类</span></span><br><span class="line">        <span class="comment">//可以再bean创建之前执行一些其他业务逻辑</span></span><br><span class="line">        System.out.println(<span class="string">&quot;实例工厂&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xml配置</span></span><br><span class="line"><span class="comment">//&lt;bean id=&quot;userDao2&quot; factory-bean=&quot;MyBeanFactory&quot; factory-method=&quot;setUserDao&quot;&gt;</span></span><br><span class="line"><span class="comment">//    &lt;constructor-arg name=&quot;name&quot; value=&quot;zhangsan&quot;&gt;&lt;/constructor-arg&gt;</span></span><br><span class="line"><span class="comment">//    &lt;constructor-arg name=&quot;age&quot; value=&quot;23&quot;&gt;&lt;/constructor-arg&gt;</span></span><br><span class="line"><span class="comment">//&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">//通过constructor-arg来配置方法的参数</span></span><br></pre></td></tr></table></figure>

<h4 id="实现FactoryBean规范延迟实例化Bean"><a href="#实现FactoryBean规范延迟实例化Bean" class="headerlink" title="实现FactoryBean规范延迟实例化Bean"></a>实现FactoryBean规范延迟实例化Bean</h4><p>Spring底层用的多，是一个接口，主要用于定义工厂Bean的规范，换言之就是给自定义工厂制定了一套标准，实现这个接口，就相当于使用了这套标准(方法名不再是自定义)，使用这套标准后，就不需要在xml文件中配置factory-method</p>
<p><strong>接口源码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.beans.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FactoryBean</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">OBJECT_TYPE_ATTRIBUTE</span> <span class="operator">=</span> <span class="string">&quot;factoryBeanObjectType&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回一个泛型为T的对象</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    T <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回当前Object的类型</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    Class&lt;?&gt; getObjectType();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否单例</span></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 实现FactoryBean 规范实例化Bean</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext3</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">UserDao</span> <span class="variable">userDao3</span> <span class="operator">=</span> (UserDao) applicationContext3.getBean(<span class="string">&quot;userDao3&quot;</span>);</span><br><span class="line">        System.out.println(userDao3);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//实现FactoryBean接口的类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyStandBeanFactory</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;UserDao&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> UserDao <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;UserDao3&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> UserDao.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xml文件</span></span><br><span class="line">&lt;!--采用 实现FactoryBean接口 规范实例化UserDao--&gt;</span><br><span class="line">    &lt;bean class=<span class="string">&quot;com.jackey.factory.MyStandBeanFactory&quot;</span> id=<span class="string">&quot;userDao3&quot;</span> &gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">静态工厂</span></span><br><span class="line"><span class="comment">实例工厂</span></span><br><span class="line"><span class="comment">UserDao3</span></span><br><span class="line"><span class="comment">com.jackey.dao.impl.UserDaoImpl@64bf3bbf</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//出现其他非相关信息是因为在xml文件中配置了其他Bean的实现，只要测试类读取配置文件就会创建Bean到容器中，</span></span><br><span class="line"><span class="comment">//所以其他Bean中的内容也会被执行，但是其他Bean的对象需要再getBean才能得到</span></span><br></pre></td></tr></table></figure>

<p>执行完后，底层单例池中存放的是工厂对象，不是UserDaoImpl对象，但控制台仍然输出的是UserDaoImpl对象的地址</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722098648407-5f73b886-3482-4a83-8d0d-7b20ac03102c.png"><br>而UserDaoImpl对象存放在</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722098769815-81da183e-6779-4eb6-9575-e86600fe26b3.png"><br><strong>当真正调用这个Bean的时候，也就是getBean的时候，才会把这个实例化的对象返回，也就是才会调用实现接口中的getObject()方法，才会放入缓存当中，当下一次调用从缓存当中取出</strong></p>
<hr>
<p><strong>注意区分BeanFactory和FactoryBean：</strong></p>
<p><strong>区别：</strong></p>
<p><strong>角色与作用</strong><strong>:</strong></p>
<p><strong>BeanFactory</strong>** 是 Spring IoC 容器的基础接口，负责管理和控制 Bean 的生命周期，包括实例化、依赖注入、初始化、销毁等。**</p>
<p><strong>FactoryBean</strong>** 是一个特殊的 Bean，实现了 FactoryBean 接口的类负责生产其他的 Bean 实例，允许在实例化过程中进行更多的控制和定制。**</p>
<p><strong>功能差异</strong><strong>:</strong></p>
<p><strong>BeanFactory</strong>** 提供了核心的 Bean 管理功能，它是一个工厂接口，可以管理和获取各种类型的 Bean 实例。**</p>
<p><strong>FactoryBean</strong>** 提供了一种扩展机制，允许开发者自定义复杂的 Bean 实例化逻辑，它本身也是一个 Bean，但其 getObject() 方法返回的不是它自身，而是它管理的另一个 Bean 的实例。**</p>
<p><strong>实现方式</strong><strong>:</strong></p>
<p><strong>BeanFactory</strong>** 是一个接口，定义了 IoC 容器的基础功能，由各种具体实现类（如 ApplicationContext）来实现。**</p>
<p><strong>FactoryBean</strong>** 是一个具体的类，实现了 FactoryBean 接口，开发者需要通过实现该接口来自定义 Bean 的创建过程。**</p>
<p><strong>联系：</strong></p>
<p><strong>BeanFactory 是 FactoryBean 的容器</strong><strong>:</strong></p>
<p><strong>BeanFactory 作为 Spring IoC 容器的基础接口，它可以管理和控制 FactoryBean 实例，FactoryBean 实例本身也是由 BeanFactory 管理的一种特殊的 Bean。</strong></p>
<p><strong>FactoryBean 可以定制 Bean 的创建逻辑</strong><strong>:</strong></p>
<p><strong>FactoryBean 接口的存在允许开发者在 Bean 实例化的过程中进行更多的控制和定制，例如根据条件动态创建不同的 Bean 实例，或者通过复杂的逻辑来决定 Bean 的初始化参数。</strong></p>
<p><strong>使用场景</strong><strong>:</strong></p>
<p><strong>使用 BeanFactory 管理和获取标准的 Bean 实例，适用于大多数的 Bean 管理场景。</strong></p>
<p><strong>使用 FactoryBean 适用于需要复杂逻辑或者定制化配置的 Bean 创建场景，例如动态代理、条件化的 Bean 创建等。</strong></p>
<p><strong>总结来说，BeanFactory 是 Spring IoC 容器的基础接口，负责管理和控制 Bean 的生命周期；而 FactoryBean 是一个特殊的 Bean，负责生产其他的 Bean 实例，可以在实例化过程中进行更多的控制和定制。它们在 Spring 应用中扮演了不同但互补的角色。</strong></p>
<h3 id="Bean的依赖注入配置"><a href="#Bean的依赖注入配置" class="headerlink" title="Bean的依赖注入配置"></a>Bean的依赖注入配置</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722580410453-189b41e2-4d1a-412b-a5ff-c846cd6aaed8.png"></p>
<h5 id="集合属性注入"><a href="#集合属性注入" class="headerlink" title="集合属性注入"></a>集合属性注入</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.mapper.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PersonMapperImpl</span> <span class="keyword">implements</span> <span class="title class_">PersonMapper</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为集合注入属性</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; arrayList;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="comment">//集合对象设置属性</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;UserDao&gt; userDaoList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//    提供set方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setArrayList</span><span class="params">(List&lt;String&gt; arrayList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.arrayList = arrayList;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDaoList</span><span class="params">(List&lt;UserDao&gt; userDaoList)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDaoList = userDaoList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showList</span><span class="params">()</span>&#123;</span><br><span class="line">        arrayList.forEach(s -&gt; System.out.println(s));</span><br><span class="line">        System.out.println(userDaoList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//xml文件</span></span><br><span class="line">&lt;!--    注入集合属性 和 对象集合--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;personMapper&quot;</span> class=<span class="string">&quot;com.jackey.mapper.impl.PersonMapperImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;arrayList&quot;</span>&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;value&gt;aaa&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;bbb&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;ccc&lt;/value&gt;</span><br><span class="line">                &lt;value&gt;ddd&lt;/value&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;userDaoList&quot;</span>&gt;</span><br><span class="line">            &lt;list&gt;</span><br><span class="line">                &lt;ref bean=<span class="string">&quot;userDao4&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">                &lt;ref bean=<span class="string">&quot;userDao5&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">                &lt;ref bean=<span class="string">&quot;userDao6&quot;</span>&gt;&lt;/ref&gt;</span><br><span class="line">            &lt;/list&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;!--    配置bean，引用bean--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userDao4&quot;</span> class=<span class="string">&quot;com.jackey.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userDao5&quot;</span> class=<span class="string">&quot;com.jackey.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userDao6&quot;</span> class=<span class="string">&quot;com.jackey.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 注入集合</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext4</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">PersonMapper</span> <span class="variable">personMapper</span> <span class="operator">=</span> (PersonMapper) applicationContext4.getBean(<span class="string">&quot;personMapper&quot;</span>);</span><br><span class="line">        System.out.println(personMapper);</span><br><span class="line">        personMapper.showList();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h4><p>以上均为手动装配</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722644594506-2a2d9041-0730-45c7-ae3e-c5b39e4855a2.png"><br>bean中的set方法，方法名去掉set，其余部分首字母小写，与xml文件中bean的id相同</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建Animal接口 和 实现类</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//配置xml文件</span></span><br><span class="line">&lt;bean id=<span class="string">&quot;userDao&quot;</span> class=<span class="string">&quot;com.jackey.dao.impl.UserDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试代码</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 自动装配</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"><span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line"><span class="type">AnimalMapper</span> <span class="variable">animalMapper</span> <span class="operator">=</span> (AnimalMapper) applicationContext5.getBean(<span class="string">&quot;animalMapper&quot;</span>);</span><br><span class="line">  System.out.println(animalMapper);</span><br></pre></td></tr></table></figure>

<h3 id="Spring的其他配置标签"><a href="#Spring的其他配置标签" class="headerlink" title="Spring的其他配置标签"></a>Spring的其他配置标签</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722652424471-4859924d-0b7c-428c-b654-7841731791f3.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722652725756-3253e10a-0205-4eba-a97a-616142ebe9f3.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722653169258-c9b4ca3f-5d99-43d1-b834-f9f67cc40a1a.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//test 测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.AnimalMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 开发环境 、 测试环境</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//指定环境</span></span><br><span class="line">        System.setProperty(<span class="string">&quot;spring.profiles.active&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext6</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">AnimalMapper</span> <span class="variable">animalMapper1</span> <span class="operator">=</span> (AnimalMapper) applicationContext6.getBean(<span class="string">&quot;animalMapper&quot;</span>);</span><br><span class="line">        System.out.println(animalMapper1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xml文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//&lt;!--    开发环境、测试环境--&gt;</span></span><br><span class="line">    &lt;beans profile=<span class="string">&quot;test&quot;</span>&gt;</span><br><span class="line">        &lt;bean id=<span class="string">&quot;animalMapper&quot;</span> class=<span class="string">&quot;com.jackey.mapper.impl.AnimalMapperImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;/beans&gt;</span><br></pre></td></tr></table></figure>

<p><strong>xml文件中，除了指定了环境的部分配置生效以外，公共部分也会生效</strong></p>
<p>导入配置文件</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722654394894-7e834828-68f0-44c6-8c33-835a881cf72d.png"><br>起别名</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722654650801-49cc4568-cb6b-425e-839c-36b2a5a207f9.png"><br>引入外部标签</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722655367373-94a120e1-e898-448e-85d4-a0fc97c97e13.png"></p>
<ol>
<li>在pom.xml文件中导入坐标</li>
<li>在xml配置文件中的命名空间中引入、配置映射地址</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722655627784-f4df3088-8f26-446f-a355-0ab68328e393.png" alt="图中灰色部分为新引入的空间"></p>
<h2 id="Spring的get方法"><a href="#Spring的get方法" class="headerlink" title="Spring的get方法"></a>Spring的get方法</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722672919968-13d2e065-1e55-4f0a-b725-526e5f2cfaa2.png">在 Spring 框架中，通常推荐通过接口来获取 Bean 对象，而不是直接使用实现类。这样做有几个好处：</p>
<ol>
<li><strong>解耦合</strong>: 通过接口获取 Bean 可以将组件之间的耦合度降低。如果后续需要替换实现类，只需修改配置文件或者注解即可，而不需要修改调用方的代码。</li>
<li><strong>动态代理</strong>: Spring 在注入 Bean 的时候，通常会使用动态代理。如果你直接通过实现类获取 Bean，可能会得到一个代理对象，而不是原始的实现类对象。因此，通过接口获取 Bean 可以确保你得到的是 Spring 管理的正确的代理对象。</li>
<li><strong>更易于测试</strong>: 在单元测试中，你可以通过模拟实现类的方式来替代真实的 Bean，这样可以更方便地进行测试。如果直接使用实现类，可能需要进行更多的设置和清理工作。</li>
</ol>
<p>具体到你的代码片段 <code>applicationContext2.getBean(PeopleService.class)</code>，假设 <code>PeopleService</code> 是一个接口，这样做就是为了遵循面向接口编程的最佳实践。Spring 在运行时会根据配置文件或者注解，自动选择合适的实现类来实例化并返回给你。</p>
<p>总结来说，通过接口获取 Bean 是一种良好的编程习惯，能够提升代码的灵活性、可维护性和可测试性。</p>
<h2 id="Spring配置非自定义的Bean"><a href="#Spring配置非自定义的Bean" class="headerlink" title="Spring配置非自定义的Bean"></a>Spring配置非自定义的Bean</h2><p>非自定义bean：第三方某些jar包中的对象，交给Spring容器管理</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722673976279-f706b613-0a54-4369-a409-8e781dacec20.png"></p>
<h3 id="DruidDatasource"><a href="#DruidDatasource" class="headerlink" title="DruidDatasource"></a>DruidDatasource</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722674040126-898f06d4-7a60-4141-a553-506f572e7c94.png"></p>
<ol>
<li>导入坐标</li>
<li>在xml配置文件中配置相关属性</li>
</ol>
<h3 id="Connection"><a href="#Connection" class="headerlink" title="Connection"></a>Connection</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722675884376-871a2d84-fa9c-48e1-80aa-af097be5ad59.png"></p>
<h3 id="SimpleDataFormat"><a href="#SimpleDataFormat" class="headerlink" title="SimpleDataFormat"></a>SimpleDataFormat</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722678504070-cef6b522-0163-406e-8cf1-c839d6685c0f.png"></p>
<h3 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a>SqlSessionFactory</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722680352845-1176d7b7-5fdd-4a21-bb43-e704c664f792.png"><br>普通创建对象的方法<img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722685851836-8da0fb88-778d-4438-a020-60ce1656355d.png"><br>将对象交给Spring容器管理</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722686631867-f01d34fb-2eff-4592-9726-ecf08f7a754d.png"><br>测试类</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722686555983-6c847885-3231-4e20-805a-19d1b1597fda.png"></p>
<h2 id="Bean的实例化基本流程"><a href="#Bean的实例化基本流程" class="headerlink" title="Bean的实例化基本流程"></a>Bean的实例化基本流程</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722686744108-ae6261b2-fe81-4986-820c-a955603cc670.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722687451174-e401e214-e822-4a9d-b450-7c563cd82cda.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722687498431-3623031e-1e42-433c-abca-e109c5c5e034.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722687574331-6921d801-6b10-4081-905f-ac6e81ae86fb.png"><br>其中有一个beanClass是维护类的全限定名，用于反射去创建对象</p>
<p><strong>内部存储的Bean的定义信息</strong></p>
<hr>
<p><strong>BeanDefinition源码</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BeanDefinition源码</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.beans.factory.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeanMetadataElement;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.MutablePropertyValues;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.AttributeAccessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.ResolvableType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDefinition</span> <span class="keyword">extends</span> <span class="title class_">AttributeAccessor</span>, BeanMetadataElement &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">SCOPE_SINGLETON</span> <span class="operator">=</span> <span class="string">&quot;singleton&quot;</span>;</span><br><span class="line">    <span class="type">String</span> <span class="variable">SCOPE_PROTOTYPE</span> <span class="operator">=</span> <span class="string">&quot;prototype&quot;</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ROLE_APPLICATION</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ROLE_SUPPORT</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">ROLE_INFRASTRUCTURE</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setParentName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getParentName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanClassName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getBeanClassName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setScope</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getScope</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setLazyInit</span><span class="params">(<span class="type">boolean</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isLazyInit</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDependsOn</span><span class="params">(<span class="meta">@Nullable</span> String... var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String[] getDependsOn();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setAutowireCandidate</span><span class="params">(<span class="type">boolean</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAutowireCandidate</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setPrimary</span><span class="params">(<span class="type">boolean</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isPrimary</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setFactoryBeanName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getFactoryBeanName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setFactoryMethodName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getFactoryMethodName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    ConstructorArgumentValues <span class="title function_">getConstructorArgumentValues</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">hasConstructorArgumentValues</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="built_in">this</span>.getConstructorArgumentValues().isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    MutablePropertyValues <span class="title function_">getPropertyValues</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">hasPropertyValues</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="built_in">this</span>.getPropertyValues().isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setInitMethodName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getInitMethodName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDestroyMethodName</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getDestroyMethodName</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setRole</span><span class="params">(<span class="type">int</span> var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> <span class="title function_">getRole</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setDescription</span><span class="params">(<span class="meta">@Nullable</span> String var1)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    ResolvableType <span class="title function_">getResolvableType</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isSingleton</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isPrototype</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isAbstract</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    String <span class="title function_">getResourceDescription</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    BeanDefinition <span class="title function_">getOriginatingBeanDefinition</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722688059873-917cd8ee-a21c-4658-8651-62a10b8e153a.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722688642279-2396cb9a-b2d1-4f2a-9b35-7bb017e9245a.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722688663191-47e4cdbd-9785-4c82-938b-2f1693c29531.png"><br><strong>基本流程概括</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722688694730-a43424f6-65ed-4394-a361-0760371ea9e2.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722688748000-f8024ee1-884b-4cd2-a672-e0866602d067.png"></p>
<h2 id="Spring的后处理器"><a href="#Spring的后处理器" class="headerlink" title="Spring的后处理器"></a>Spring的后处理器</h2><p>bean实例化-&gt;属性赋值-&gt;bean前置处理-&gt;bean初始化-&gt;bean后置处理-&gt;使用</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722688896587-8d65f575-8f68-409a-af81-1517ba36ba50.png"></p>
<h3 id="BeanFactoryPostProcessor"><a href="#BeanFactoryPostProcessor" class="headerlink" title="BeanFactoryPostProcessor"></a>BeanFactoryPostProcessor</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722689521290-2511bf43-a50b-425a-8382-de10da5f3f4b.png"></p>
<h4 id="修改BeanDefinition"><a href="#修改BeanDefinition" class="headerlink" title="修改BeanDefinition"></a>修改BeanDefinition</h4><p>自定义类实现该接口，再将该类交给Spring容器管理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义类实现BeanFactoryPostProcessor接口</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当完成beanDefinitionMap填充后，回调该方法&quot;</span>);</span><br><span class="line"><span class="comment">//        修改beanDefinition，在实例化bean之前改变bean</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> configurableListableBeanFactory.getBeanDefinition(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line"><span class="comment">//      设置bean的全限定名 改变bean</span></span><br><span class="line">        beanDefinition.setBeanClassName(<span class="string">&quot;com.jackey.mapper.impl.AnimalMapperImpl&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.AnimalMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;processorContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userService</span> <span class="operator">=</span> applicationContext7.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置文件xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     &lt;bean id=&quot;userService&quot; class=&quot;com.jackey.service.Impl.UserServiceImpl&quot;&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">// &lt;!--    &lt;bean id=&quot;animalMapper&quot; class=&quot;com.jackey.service.Impl.UserServiceImpl&quot;&gt;&lt;/bean&gt;--&gt;</span></span><br><span class="line"><span class="comment">//     &lt;bean id=&quot;processor&quot; class=&quot;com.jackey.processor.MyBeanFactoryPostProcessor&quot;&gt;&lt;/bean&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line"><span class="comment">// 当完成beanDefinitionMap填充后，回调该方法</span></span><br><span class="line"><span class="comment">// com.jackey.mapper.impl.AnimalMapperImpl@7f0eb4b4</span></span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722698146980-149d86f5-11cb-4df0-927d-8c6ad84105f6.png"><br> 设置bean的全限定名 改变bean，发现bean的名字是UserService，但是bean的value变成了AnimalMapperImpl</p>
<blockquote>
<p><strong>存疑– 乌龙 xml中注册bean的全限定名写错了</strong></p>
<p><strong>当将AnimalMapperImpl也配置进xml文件中，会发现UserService中的内容是AnimalMapperImpl的</strong></p>
<p><strong>而AnimalMapper中的内容是UserServiceImpl的，也就是bean中的内容发生了自动变换，两个bean都进行了创建，出现在了单例池中</strong></p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722698480584-55d81cec-8746-4731-a572-116afc040c67.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义类实现BeanFactoryPostProcessor接口</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;当完成beanDefinitionMap填充后，回调该方法&quot;</span>);</span><br><span class="line"><span class="comment">//        修改beanDefinition，在实例化bean之前改变bean</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> configurableListableBeanFactory.getBeanDefinition(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line"><span class="comment">//      设置bean的全限定名 改变bean</span></span><br><span class="line">        beanDefinition.setBeanClassName(<span class="string">&quot;com.jackey.mapper.impl.AnimalMapperImpl&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.AnimalMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext7</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;processorContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">userService</span> <span class="operator">=</span> applicationContext7.getBean(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        System.out.println(userService);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//配置文件xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//     &lt;bean id=&quot;userService&quot; class=&quot;com.jackey.service.Impl.UserServiceImpl&quot;&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">//     &lt;bean id=&quot;animalMapper&quot; class=&quot;com.jackey.service.Impl.UserServiceImpl&quot;&gt;&lt;/bean&gt;</span></span><br><span class="line"><span class="comment">//     &lt;bean id=&quot;processor&quot; class=&quot;com.jackey.processor.MyBeanFactoryPostProcessor&quot;&gt;&lt;/bean&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行结果</span></span><br><span class="line"><span class="comment">// 当完成beanDefinitionMap填充后，回调该方法</span></span><br><span class="line"><span class="comment">// afterPropertiesSet方法执行</span></span><br><span class="line"><span class="comment">// com.jackey.mapper.impl.AnimalMapperImpl@57a3af25</span></span><br></pre></td></tr></table></figure>



<h4 id="注册BeanDefinition"><a href="#注册BeanDefinition" class="headerlink" title="注册BeanDefinition"></a>注册BeanDefinition</h4><p><strong>不需要在xml文件中配置bean，通过bean工厂后处理器同样可以完成实例化bean</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义类MyBeanFactoryPostProcessor实现BeanFactoryPostProcessor接口</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanFactoryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.DefaultListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.RootBeanDefinition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;当完成beanDefinitionMap填充后，回调该方法&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 注册beanDefinition</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="comment">//使用beanDefinition接口的实现 RootBeanDefinition</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>();</span><br><span class="line">        beanDefinition.setBeanClassName(<span class="string">&quot;com.jackey.dao.impl.PersonDaoImpl&quot;</span>);</span><br><span class="line">        <span class="comment">//强转成DefaultListBeanFactory 内部维护的方法多 为了使用registerBeanDefinition方法</span></span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">defaultListableBeanFactory</span> <span class="operator">=</span> (DefaultListableBeanFactory) configurableListableBeanFactory;</span><br><span class="line">        <span class="comment">//注册 将beanDefinition放入到BeanDefinitionMap中</span></span><br><span class="line">        defaultListableBeanFactory.registerBeanDefinition(<span class="string">&quot;personDao&quot;</span>,beanDefinition);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">测试类</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.AnimalMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//PostProcessor后处理器，注册beanDefinition</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">classPathXmlApplicationContext8</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;processorContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">personDao</span> <span class="operator">=</span> classPathXmlApplicationContext8.getBean(<span class="string">&quot;personDao&quot;</span>);</span><br><span class="line">        System.out.println(personDao);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>除了以上方式外，Spring提供了专门注册BeanDefinition的接口</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722737704362-dbc59235-5504-4ef8-9d1c-88ece30b1d20.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BeanDefinitionRegistryPostProcessor源码</span></span><br><span class="line"><span class="comment">// Source code recreated from a .class file by IntelliJ IDEA</span></span><br><span class="line"><span class="comment">// (powered by FernFlower decompiler)</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.beans.factory.support;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanFactoryPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> <span class="keyword">extends</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry var1)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="完善Bean的实例化基本流程"><a href="#完善Bean的实例化基本流程" class="headerlink" title="完善Bean的实例化基本流程"></a>完善Bean的实例化基本流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722739531289-6f1df288-30c2-48b3-aea9-80bc643d6854.png"></p>
<h3 id="使用Spring的BeanDefinitionRegistryPostProcessor案例"><a href="#使用Spring的BeanDefinitionRegistryPostProcessor案例" class="headerlink" title="使用Spring的BeanDefinitionRegistryPostProcessor案例"></a>使用Spring的BeanDefinitionRegistryPostProcessor案例</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722739928103-5f39f2ae-fb9f-4691-ac10-8b8881552df6.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建类MyComponentBeanFactoryPostProcessor 实现 将beanDefinition注册</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.utils.BaseClassScanUtils;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanDefinition;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.ConfigurableListableBeanFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionRegistry;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.BeanDefinitionRegistryPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.support.RootBeanDefinition;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyComponentBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanDefinitionRegistryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanDefinitionRegistry</span><span class="params">(BeanDefinitionRegistry beanDefinitionRegistry)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">//通过扫描工具去扫描指定包及其子包下的所有类，收集使用了@MyComponent注解的类</span></span><br><span class="line">        Map&lt;String, Class&gt; myComponentAnnotationMap = BaseClassScanUtils.scanMyComponentAnnotation(<span class="string">&quot;com.jackey&quot;</span>);</span><br><span class="line">        <span class="comment">//遍历Map，组装BeanDefinition进行注册</span></span><br><span class="line">        myComponentAnnotationMap.forEach((beanName, clazz) -&gt; &#123;</span><br><span class="line">            <span class="comment">//反射获得BeanClassName   com.jackey.beans.DemoBean</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">beanClassName</span> <span class="operator">=</span> clazz.getName();</span><br><span class="line">            <span class="comment">//创建BeanDefinition</span></span><br><span class="line">            <span class="type">BeanDefinition</span> <span class="variable">beanDefinition</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RootBeanDefinition</span>(beanClassName);</span><br><span class="line">            <span class="comment">//注册</span></span><br><span class="line">            beanDefinitionRegistry.registerBeanDefinition(beanClassName,beanDefinition);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory configurableListableBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//类 扫描工具 扫描注解@MyComponent</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.anno.MyComponent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.Resource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.PathMatchingResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.io.support.ResourcePatternResolver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.CachingMetadataReaderFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.MetadataReader;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.type.classreading.MetadataReaderFactory;</span><br><span class="line"><span class="keyword">import</span> org.springframework.util.ClassUtils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Annotation;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseClassScanUtils</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//设置资源规则</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">RESOURCE_PATTERN</span> <span class="operator">=</span> <span class="string">&quot;/**/*.class&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Class&gt; <span class="title function_">scanMyComponentAnnotation</span><span class="params">(String basePackage)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建容器存储使用了指定注解的Bean字节码对象</span></span><br><span class="line">        Map&lt;String, Class&gt; annotationClassMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Class&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//spring工具类，可以获取指定路径下的全部类</span></span><br><span class="line">        <span class="type">ResourcePatternResolver</span> <span class="variable">resourcePatternResolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PathMatchingResourcePatternResolver</span>();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">pattern</span> <span class="operator">=</span> ResourcePatternResolver.CLASSPATH_ALL_URL_PREFIX +</span><br><span class="line">                    ClassUtils.convertClassNameToResourcePath(basePackage) + RESOURCE_PATTERN;</span><br><span class="line">            Resource[] resources = resourcePatternResolver.getResources(pattern);</span><br><span class="line">            <span class="comment">//MetadataReader 的工厂类</span></span><br><span class="line">            <span class="type">MetadataReaderFactory</span> <span class="variable">refractory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CachingMetadataReaderFactory</span>(resourcePatternResolver);</span><br><span class="line">            <span class="keyword">for</span> (Resource resource : resources) &#123;</span><br><span class="line">                <span class="comment">//用于读取类信息</span></span><br><span class="line">                <span class="type">MetadataReader</span> <span class="variable">reader</span> <span class="operator">=</span> refractory.getMetadataReader(resource);</span><br><span class="line">                <span class="comment">//扫描到的class</span></span><br><span class="line">                <span class="type">String</span> <span class="variable">classname</span> <span class="operator">=</span> reader.getClassMetadata().getClassName();</span><br><span class="line">                Class&lt;?&gt; clazz = Class.forName(classname);</span><br><span class="line">                <span class="comment">//判断是否属于指定的注解类型</span></span><br><span class="line">                <span class="keyword">if</span>(clazz.isAnnotationPresent(MyComponent.class))&#123;</span><br><span class="line">                    <span class="comment">//获得注解对象</span></span><br><span class="line">                    <span class="type">MyComponent</span> <span class="variable">annotation</span> <span class="operator">=</span> clazz.getAnnotation(MyComponent.class);</span><br><span class="line">                    <span class="comment">//获得属value属性值</span></span><br><span class="line">                    <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> annotation.value();</span><br><span class="line">                    <span class="comment">//判断是否为&quot;&quot;</span></span><br><span class="line">                    <span class="keyword">if</span>(beanName!=<span class="literal">null</span>&amp;&amp;!beanName.equals(<span class="string">&quot;&quot;</span>))&#123;</span><br><span class="line">                        <span class="comment">//存储到Map中去</span></span><br><span class="line">                        annotationClassMap.put(beanName,clazz);</span><br><span class="line">                        <span class="keyword">continue</span>;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">//如果没有为&quot;&quot;,那就把当前类的类名作为beanName</span></span><br><span class="line">                    annotationClassMap.put(clazz.getSimpleName(),clazz);</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception exception) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> annotationClassMap;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Class&gt; stringClassMap = scanMyComponentAnnotation(<span class="string">&quot;com.jackey&quot;</span>);</span><br><span class="line">        System.out.println(stringClassMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.beans.DemoBean;</span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.AnimalMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 自定义注解MyComponent</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext9</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;MyComponentContext.xml&quot;</span>);</span><br><span class="line">        <span class="type">DemoBean</span> <span class="variable">demoBean</span> <span class="operator">=</span> applicationContext9.getBean(DemoBean.class);</span><br><span class="line">        System.out.println(demoBean);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//bean</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.beans;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.anno.MyComponent;</span><br><span class="line"></span><br><span class="line"><span class="meta">@MyComponent(&quot;demoBean&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DemoBean</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//运行结果</span></span><br><span class="line"><span class="comment">//com.jackey.beans.DemoBean@72b6cbcc</span></span><br></pre></td></tr></table></figure>

<h3 id="BeanPostProcessor"><a href="#BeanPostProcessor" class="headerlink" title="BeanPostProcessor"></a>BeanPostProcessor</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722760415450-0423eaa6-b224-4ed5-81fb-20dd0f1b9f47.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722761005266-d88241b2-5acc-4086-81bd-47bc060bb822.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722760944242-550772a4-9dc8-428e-a323-7125d409ecb9.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BeanPostProcessor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.jackey.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(beanName+<span class="string">&quot;:postProcessBeforeInitialization&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        System.out.println(beanName+<span class="string">&quot;:postProcessAfterInitialization&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.Test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.beans.DemoBean;</span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.AnimalMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.mapper.PersonMapper;</span><br><span class="line"><span class="keyword">import</span> com.jackey.service.UserService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    </span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;beanpostprocessContext.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//xml文件</span></span><br><span class="line"></span><br><span class="line">    &lt;bean class=<span class="string">&quot;com.jackey.mapper.impl.AnimalMapperImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;bean class=<span class="string">&quot;com.jackey.dao.impl.PersonDaoImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;bean class=<span class="string">&quot;com.jackey.processor.MyBeanPostProcessor&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">运行结果</span></span><br><span class="line"><span class="comment">com.jackey.mapper.impl.AnimalMapperImpl#0:postProcessBeforeInitialization</span></span><br><span class="line"><span class="comment">com.jackey.mapper.impl.AnimalMapperImpl#0:postProcessAfterInitialization</span></span><br><span class="line"><span class="comment">com.jackey.dao.impl.PersonDaoImpl#0:postProcessBeforeInitialization</span></span><br><span class="line"><span class="comment">com.jackey.dao.impl.PersonDaoImpl#0:postProcessAfterInitialization</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>由此可以得知，当在xml中配置了Bean，并将Bean后处理器同样配置到xml当中，Spring容器会自动在Bean的初始化过程中将Bean后处理器中的方法加入到Bean中，不论配置几个Bean。</p>
<p>在Spring框架中，Bean后处理器（BeanPostProcessor）是一种特殊类型的Bean，它允许在容器实例化Bean并在依赖注入（DI）发生之前或之后执行自定义的初始化和销毁逻辑。Bean后处理器需要在Spring容器中显式配置，并且其实例化和初始化过程是由Spring容器管理的。</p>
<p>如果在XML配置文件中将Bean后处理器配置为一个Bean，并将其注册到Spring容器中，那么Spring容器在实例化和初始化其他普通Bean时，会自动检测是否存在注册的Bean后处理器。如果存在，Spring容器会将该Bean后处理器应用于容器中所有符合条件的Bean。</p>
<p>具体来说：</p>
<ul>
<li>在XML配置文件中配置Bean后处理器时，需要使用 <code>&lt;bean&gt;</code> 元素来定义该后处理器的Bean。</li>
<li>Spring容器会自动检测实现了 <code>BeanPostProcessor</code> 接口的Bean，并将其应用于容器中的所有Bean。</li>
<li>Bean后处理器的主要方法是 <code>postProcessBeforeInitialization</code> 和 <code>postProcessAfterInitialization</code>，分别在Bean的初始化前后调用，允许开发者执行额外的逻辑操作。</li>
</ul>
<p>因此，无论你在XML配置中有多少个普通Bean，只要你配置了相应的Bean后处理器，并且将其注册到Spring容器中，Spring会确保在所有符合条件的Bean的初始化过程中调用该后处理器的方法。这确保了你可以在Bean初始化前后进行自定义的操作，而不需要显式地在每个Bean的配置中添加额外的初始化逻辑。</p>
<p><strong>实例化Bean过程中，方法的执行顺序如下</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722771621318-93a18aa2-cbb8-4565-8db6-3e90d09b88ed.png"></p>
<h3 id="再完善Bean实例化的基本流程"><a href="#再完善Bean实例化的基本流程" class="headerlink" title="再完善Bean实例化的基本流程"></a>再完善Bean实例化的基本流程</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722772655962-72d005a8-7a11-45f2-874c-d830ccdab4b4.png"></p>
<h2 id="SpringBean的生命周期"><a href="#SpringBean的生命周期" class="headerlink" title="SpringBean的生命周期"></a>SpringBean的生命周期</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722818653737-1a323b72-27fa-4e3e-b3ab-f0ccf913c6fc.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722819562275-0b5ec9a7-7139-42ce-9fb3-dd5e55bb45bf.png"></p>
<h3 id="Bean的实例属性填充"><a href="#Bean的实例属性填充" class="headerlink" title="Bean的实例属性填充"></a>Bean的实例属性填充</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722821391954-dcaf4296-8eeb-4671-86d0-ba47f9b0b039.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722821822002-50490fc4-38b9-4a4c-a607-a096b09c62d8.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722822302248-a3dd0f72-32bb-4627-866b-64060d308d3d.png"><br>执行流程</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722822478300-942b4dfd-4803-4e9f-9610-dd104f0b8117.png"><br>虽然是半成品，但是可以先把这个半成品设置为自己的属性，后面再往这个半成品里填东西（也就是把这个半成品补全）</p>
<h4 id="三级缓存"><a href="#三级缓存" class="headerlink" title="三级缓存"></a>三级缓存</h4><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722822795009-9498ebbd-ede9-47c9-a1e2-51e55c8b1967.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一级缓存</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">256</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//二级缓存</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>(<span class="number">16</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//三级缓存</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>(<span class="number">16</span>);</span><br></pre></td></tr></table></figure>

<pre><code>**一般情况下 ，三级缓存存储的bean是未被引用过的半成品bean，二级缓存存储的是已经被引用的半成品bean**
</code></pre>
<p><strong>二级缓存用于存储被引用的对象，如果没被引用直接会从三到一，不走二</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722825137782-9d33fec7-a80e-4644-badb-e013d020c4df.png"><br><a target="_blank" rel="noopener" href="https://www.yuque.com/attachments/yuque/0/2024/pdf/44321693/1722825588018-8bffcf76-26e1-4688-a36b-ee61c2927d0d.pdf">三级缓存源码剖析流程.pdf</a></p>
<ol>
<li>实例化bean，将bean的ObjectFactory对象存入到三级缓存中</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722826164138-e4535ba7-7cec-4b1f-beb3-3ff5f9ecfd4c.png"><br>2. 在三级缓存中寻找userService，放入二级缓存</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722828035721-498151e9-0acf-4e0f-864e-7e641f7ffc94.png"><br>3. </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722829202049-e67ce5bf-fc26-4f69-8d41-eab0d7962baf.png"><br>4. </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722829289759-947b810b-cb94-464b-a0e2-f3b4f84c052a.png"><br>5. </p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722829369793-d763d46b-ab37-4292-b8bc-6dae8d6ff7a5.png"></p>
<h3 id="常用的Aware接口"><a href="#常用的Aware接口" class="headerlink" title="常用的Aware接口"></a>常用的Aware接口</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722854106509-3f6b0307-94bd-480e-9c15-ccb4cb8a4505.png"></p>
<h2 id="SpringIoC流程总结"><a href="#SpringIoC流程总结" class="headerlink" title="SpringIoC流程总结"></a>SpringIoC流程总结</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722854867086-51966b85-5424-40fa-af49-5bb61811431a.png">———————————————————————————————————–<br>以下内容尚未完善</p>
<h2 id="？Spring-xml方式整合第三方框架-整合模式-P57-P66"><a href="#？Spring-xml方式整合第三方框架-整合模式-P57-P66" class="headerlink" title="？Spring xml方式整合第三方框架(整合模式) P57-P66"></a>？Spring xml方式整合第三方框架(整合模式) P57-P66</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722856683548-6391f8aa-bad6-4bc3-a152-3ef8bf745725.png"></p>
<h3 id="Spring整合Mybatis"><a href="#Spring整合Mybatis" class="headerlink" title="Spring整合Mybatis"></a>Spring整合Mybatis</h3><p>原始写法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//加载配置文件</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">is</span> <span class="operator">=</span> Resources.getResourceAsStream(<span class="string">&quot;mybatis-config.xml&quot;</span>);</span><br><span class="line"><span class="comment">//创建sqlSession对象</span></span><br><span class="line"><span class="type">SqlSessionFactoryBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBuilder</span>();</span><br><span class="line"><span class="type">SqlSessionFactory</span> <span class="variable">sqlSessionFactory</span> <span class="operator">=</span> builder.build(is);</span><br><span class="line"><span class="type">SqlSession</span> <span class="variable">sqlSession</span> <span class="operator">=</span> sqlSessionFactory.openSession();</span><br><span class="line"><span class="type">PurchaseMapper</span> <span class="variable">mapper</span> <span class="operator">=</span> sqlSession.getMapper(PurchaseMapper.class);</span><br><span class="line">List&lt;Purchase&gt; purchaseList = mapper.listAll();</span><br></pre></td></tr></table></figure>

<p>这段代码是使用 MyBatis 进行数据库操作的一个示例。让我们逐步解释每一行代码的作用：</p>
<ol>
<li><code>InputStream is = Resources.getResourceAsStream(&quot;mybatis-config.xml&quot;);</code><ul>
<li>这一行通过 MyBatis 提供的 <code>Resources</code> 类加载名为 “mybatis-config.xml” 的配置文件，返回一个 <code>InputStream</code> 对象 <code>is</code>。这个配置文件通常包含了数据库连接信息、映射器配置等。</li>
</ul>
</li>
<li><code>SqlSessionFactoryBuilder builder = new SqlSessionFactoryBuilder();</code><ul>
<li>创建一个 <code>SqlSessionFactoryBuilder</code> 对象 <code>builder</code>。<code>SqlSessionFactoryBuilder</code> 是用来创建 <code>SqlSessionFactory</code> 的构建器。</li>
</ul>
</li>
<li><code>SqlSessionFactory sqlSessionFactory = builder.build(is);</code><ul>
<li>使用 <code>builder</code> 构建 <code>SqlSessionFactory</code> 对象 <code>sqlSessionFactory</code>。<code>SqlSessionFactory</code> 是 MyBatis 的核心接口之一，负责创建 <code>SqlSession</code> 对象，从而与数据库进行交互。</li>
</ul>
</li>
<li><code>SqlSession sqlSession = sqlSessionFactory.openSession();</code><ul>
<li>通过 <code>sqlSessionFactory</code> 创建一个 <code>SqlSession</code> 对象 <code>sqlSession</code>。<code>SqlSession</code> 提供了执行 SQL 命令、获取映射器等操作的方法。</li>
</ul>
</li>
<li><code>PurchaseMapper mapper = sqlSession.getMapper(PurchaseMapper.class);</code><ul>
<li>通过 <code>sqlSession</code> 的 <code>getMapper</code> 方法获取一个 <code>PurchaseMapper</code> 接口的实现类实例 <code>mapper</code>。<code>PurchaseMapper</code> 是一个由 MyBatis 根据配置和接口生成的映射器接口，用于执行数据库操作。</li>
</ul>
</li>
<li><code>List&lt;Purchase&gt; purchaseList = mapper.listAll();</code><ul>
<li>调用 <code>mapper</code> 的 <code>listAll</code> 方法，这个方法可能是在 <code>PurchaseMapper</code> 接口中定义的，用于查询数据库并返回一个 <code>List&lt;Purchase&gt;</code>，即购买记录列表。</li>
</ul>
</li>
</ol>
<p>总结一下，这段代码的主要流程是：</p>
<ul>
<li>加载 MyBatis 的配置文件 <code>mybatis-config.xml</code>。</li>
<li>创建并配置 <code>SqlSessionFactory</code>，它是 MyBatis 的核心接口，用于创建数据库会话 <code>SqlSession</code>。</li>
<li>通过 <code>SqlSession</code> 获取映射器 <code>mapper</code>，并使用 <code>mapper</code> 执行数据库操作，这里是获取所有购买记录的列表。</li>
</ul>
<p>这种方式利用了 MyBatis 的对象关系映射（ORM）能力，将数据库操作封装在映射器接口中，使得代码更加模块化和易于维护。</p>
<p>整合</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722856879270-0f9b543f-dd10-469e-b0e5-16c28ea2c835.png"></p>
<ol>
<li>导入依赖坐标</li>
</ol>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722861149293-e8809d17-534e-4fb4-ada6-ef5cc9c4680c.png"><br>2. 编写Mapper和Mapper.xml<br>3. 配置SqlSessionFactoryBean和MapperScannerConfigurer</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SqlSessionFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;SqlSessionFactory&gt;, InitializingBean, ApplicationListener&lt;ApplicationEvent&gt; &#123;</span><br><span class="line">    <span class="comment">//实现了FactoryBean的接口</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//.......</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//主要作用是提供SqlSessionFactory</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactory <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.sqlSessionFactory == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.afterPropertiesSet();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.sqlSessionFactory;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//..........</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722863687676-d55be7d6-1690-4b29-8d4c-abadb22b8ef6.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722863022735-e1979287-3dd3-4ca4-8d29-2fc3a5023d44.png"><br>可以替代<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722863040963-9637a0e8-110c-44dd-bff6-4193e23a19f0.png"></p>
<h3 id="Spring整合MyBatis的原理"><a href="#Spring整合MyBatis的原理" class="headerlink" title="Spring整合MyBatis的原理"></a>Spring整合MyBatis的原理</h3><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722863645397-5ea99cc3-8940-466c-9b6c-c13e0dc39373.png"></p>
<h1 id="基于注解的Spring应用"><a href="#基于注解的Spring应用" class="headerlink" title="基于注解的Spring应用"></a>基于注解的Spring应用</h1><h2 id="Bean基本注解开发"><a href="#Bean基本注解开发" class="headerlink" title="Bean基本注解开发"></a>Bean基本注解开发</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722868442297-00c59d57-6b46-4ef7-a863-aa35d666dfb3.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722868588650-0921b8bb-9130-451e-85fc-bdefd3a50c99.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">       &quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--开启注解组件扫描：扫描指定包及其子包下的类，识别使用使用<span class="meta">@Component</span>注解--&gt;</span><br><span class="line">    &lt;context:component-scan base-<span class="keyword">package</span>=<span class="string">&quot;com.jackey&quot;</span>/&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.jackey.dao.impl;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.dao.UserDao;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将对象实例化 并以指定的名字存储到Spring容器当中</span></span><br><span class="line"><span class="meta">@Component(&quot;userDao&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">UserDao</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>若注解未指定beanname，默认beanname为类名且首字母小写</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722913110788-ef3ddd27-bfbd-4f89-a4c4-8785a70497b0.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722932368749-a194c5c7-d3ea-4dc8-9b0e-e5dc21e44ead.png"><br>除此以外的三层架构中，其他类使用@Component注解标注</p>
<h2 id="Bean依赖注入注解开发"><a href="#Bean依赖注入注解开发" class="headerlink" title="Bean依赖注入注解开发"></a>Bean依赖注入注解开发</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722933429826-f52f0faf-8b6b-4622-82ee-0a2e759e39f1.png"><br>@Value一般用于读取配置文件的属性</p>
<p>@Autowired更具类型进行注入，如果统一类型的Bean有多个，尝试根据名字进行二次匹配，匹配不成功则注入失败</p>
<p>@Qualifier可以和@Autowired结合一起使用，作用是根据名称注入相应的Bean，也可以单独使用注入方法的参数</p>
<p>@Resource 不指定名称参数的时候，根据类型注入，指定名称就根据名称注入</p>
<h2 id="非自定义Bean注解开发"><a href="#非自定义Bean注解开发" class="headerlink" title="非自定义Bean注解开发"></a>非自定义Bean注解开发</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722937531563-988d7078-2fb8-4a34-a02c-2ec439b58321.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722938549774-92d5b21f-597b-4193-b105-a68391baa587.png"><br>在方法参数的属性注入对象引用，按照类型注入可以直接注入，省略@Autowired</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722938732135-33596f6a-b5a8-4b8e-b067-509d7fcd2479.png"></p>
<h2 id="Bean配置类的注解开发"><a href="#Bean配置类的注解开发" class="headerlink" title="Bean配置类的注解开发"></a>Bean配置类的注解开发</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722938888075-2d9d4d5d-1797-4a8a-a098-f1dcc9baaca7.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722939296753-31be9ceb-ed52-40ac-869d-345200296ec1.png"><br>当使用注解去配置配置文件，需要更换加载配置文件的方式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722939888738-423e37f2-3b0d-4863-831f-512393b2f6b5.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722940287804-80627325-a769-445f-8b63-7f8b88bd650e.png"><br>同样也可以引入其他配置类到核心配置类当中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722940353348-9b7bbbf4-3ead-4e43-bea3-5015fd958184.png"><br><code>**&lt;font style=&quot;color:rgb(36, 41, 47);&quot;&gt;@Mapper&lt;/font&gt;**</code><strong><font style="color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);"> 标记的接口不是由Spring管理的Bean，但是可以在Spring管理的Service层中通过 </font></strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);&quot;&gt;@Autowired&lt;/font&gt;**</code><strong><font style="color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);"> 注解获取到MyBatis生成的Mapper接口的代理对象，从而在Service层中使用Mapper的方法来操作数据库。</font></strong></p>
<h2 id="Spring配置其他注解"><a href="#Spring配置其他注解" class="headerlink" title="Spring配置其他注解"></a>Spring配置其他注解</h2><h2 id=""><a href="#" class="headerlink" title=""></a><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722940430085-15a06840-241a-412f-9f7a-3937da6121f9.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722940688440-6937a839-c147-4846-96d9-8335f283fc74.png"></h2><p>以下内容未完善</p>
<h2 id="？Spring注解的原理解析-p76-79"><a href="#？Spring注解的原理解析-p76-79" class="headerlink" title="？Spring注解的原理解析 p76-79"></a>？Spring注解的原理解析 p76-79</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722942223801-7e8cca0e-2023-4df8-b03a-b494e8f5be66.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722942784558-eab39804-c898-455b-ad62-b73b3aecce3e.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722943647067-0b031d6e-c218-4065-928e-02ad245c0f76.png"></p>
<h2 id="？Spring注解整合第三方框架-p80"><a href="#？Spring注解整合第三方框架-p80" class="headerlink" title="？Spring注解整合第三方框架 p80"></a>？Spring注解整合第三方框架 p80</h2><hr>
<h1 id="AOP简介"><a href="#AOP简介" class="headerlink" title="AOP简介"></a>AOP简介</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722946389194-83b39b8e-29fe-48a1-a746-34df95999010.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722946635733-8001d16d-6924-4840-aca6-4f4b747fac67.png"></p>
<h2 id="AOP相关概念"><a href="#AOP相关概念" class="headerlink" title="AOP相关概念"></a>AOP相关概念</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722990841980-9c9cfda2-b050-4724-9325-6db5839780a5.png"></p>
<h2 id="AOP思想实现的方案"><a href="#AOP思想实现的方案" class="headerlink" title="AOP思想实现的方案"></a>AOP思想实现的方案</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722946757201-420b4104-4e76-418f-aacb-954d037a4ef6.png"></p>
<h2 id="模拟AOP的基础代码-动态代理"><a href="#模拟AOP的基础代码-动态代理" class="headerlink" title="模拟AOP的基础代码(动态代理)"></a>模拟AOP的基础代码(动态代理)</h2><p> <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1722947753585-aacc2b78-2b6f-43dc-89e3-dd85fe5fd842.png"></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;peopleService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.jackey.service.impl.PeopleServiceImpl&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myAdvice&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.jackey.advice.MyAdvice&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.jackey.processor.MockAopBeanPostProcessor&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PeopleServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">PeopleService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show1</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show1....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">show2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;show2....&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.advice;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">beforeAdvice</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;增强前置方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterAdvice</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;增强后置方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.processor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.advice.MyAdvice;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.config.BeanPostProcessor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MockAopBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span>, ApplicationContextAware &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">//目的：对PeopleServiceImpl中的show1、show2方法进行增强，增强方法在MyAdvice中</span></span><br><span class="line">        <span class="comment">//问题1：如何筛选service.impl包下的所有类的所有方法都可以增强，解决方案if-else</span></span><br><span class="line">        <span class="comment">//问题2：MyAdvice怎么获取到？ 解决方案：从Spring容器中区获取MyAdvice方法</span></span><br><span class="line">        <span class="keyword">if</span> (bean.getClass().getPackage().getName().equals(<span class="string">&quot;com.jackey.service.impl&quot;</span>)) &#123;</span><br><span class="line">            <span class="comment">//生成当前Bean的Proxy对象</span></span><br><span class="line">            <span class="type">Object</span> <span class="variable">beanProxy</span> <span class="operator">=</span> Proxy.newProxyInstance(</span><br><span class="line">                    <span class="comment">//类加载器</span></span><br><span class="line">                    bean.getClass().getClassLoader(),</span><br><span class="line">                    <span class="comment">//接口</span></span><br><span class="line">                    bean.getClass().getInterfaces(),</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">new</span> <span class="title class_">InvocationHandler</span>() &#123;</span><br><span class="line">                        <span class="meta">@Override</span></span><br><span class="line">                        <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line"></span><br><span class="line">                            <span class="type">MyAdvice</span> <span class="variable">myAdvice</span> <span class="operator">=</span> applicationContext.getBean(MyAdvice.class);</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//执行增强对象的before方法</span></span><br><span class="line">                            myAdvice.beforeAdvice();</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//执行目标对象的方法 参数1 目标对象  目标对象方法参数</span></span><br><span class="line">                            <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(bean,args);</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//执行增强对象的after方法</span></span><br><span class="line">                            myAdvice.afterAdvice();</span><br><span class="line"></span><br><span class="line">                            <span class="comment">//返回对象的返回值</span></span><br><span class="line">                            <span class="keyword">return</span> result;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">            );</span><br><span class="line">            <span class="keyword">return</span> beanProxy;</span><br><span class="line">        &#125;<span class="keyword">else</span></span><br><span class="line">            <span class="comment">//如果进不了if则原封不动的返回bean</span></span><br><span class="line">            <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实现ApplicationContextAware接口 以获取注入到applicationContext的对象实例</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="built_in">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>将目标对象bean交给Spring容器管理，再通过bean后处理器将bean中的方法增强，使用动态代理将增强对象的方法给目标对象增强</strong></p>
<p><strong>其中的关键点：增强对象再xml文件中配置，通过实现接口ApplicationContextAware，来回调注入到applicationContext中对象</strong></p>
<h1 id="基于xml配置的AOP"><a href="#基于xml配置的AOP" class="headerlink" title="基于xml配置的AOP"></a>基于xml配置的AOP</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723001336128-7254ca94-35a6-48df-bf0e-2dcac2cbfe8e.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723001762123-e8e4883a-4f1a-43a6-9b2e-7c9691f866bf.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723001789159-bec140e6-49ec-4aaf-89f2-5648ed43e618.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723002260304-c2187780-aeec-41a3-8a81-95cf57f220ab.png"><br>修改命名空间</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723002598249-892e3a71-cba0-437b-8fef-1a142ad2f2bd.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723002223675-4e24440b-da47-492b-bb18-62d63ab07699.png"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//pom.xml</span></span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">     &lt;groupId&gt;org.aspectj&lt;/groupId&gt;</span><br><span class="line">     &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;</span><br><span class="line">     &lt;version&gt;<span class="number">1.9</span><span class="number">.7</span>&lt;/version&gt;</span><br><span class="line"> &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//applicationContext.xml</span></span><br><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xmlns:context=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span><br><span class="line">       xmlns:aop=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/context/spring-context.xsd</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/aop</span></span><br><span class="line"><span class="string">       http://www.springframework.org/schema/aop/spring-aop.xsd</span></span><br><span class="line"><span class="string">       &quot;</span>&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!--    注解配置aop--&gt;</span><br><span class="line">    &lt;!--    目标对象--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;peopleService&quot;</span> class=<span class="string">&quot;com.jackey.service.impl.PeopleServiceImpl&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;!--    增强对象--&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;myAdvice&quot;</span> class=<span class="string">&quot;com.jackey.advice.MyAdvice&quot;</span>&gt;&lt;/bean&gt;</span><br><span class="line">    &lt;!--    aop配置--&gt;</span><br><span class="line">    &lt;aop:config&gt;</span><br><span class="line">        &lt;!--        配置切点表达式，目的是指定哪些方法要被增强--&gt;</span><br><span class="line">        &lt;aop:pointcut id=<span class="string">&quot;myPointCut&quot;</span> expression=<span class="string">&quot;execution(void com.jackey.service.impl.PeopleServiceImpl.show1())&quot;</span>/&gt;</span><br><span class="line">        &lt;!--        配置织入，目的是将目标方法与增强方法织入--&gt;</span><br><span class="line">        &lt;aop:aspect ref=<span class="string">&quot;myAdvice&quot;</span>&gt;</span><br><span class="line">            &lt;aop:before method=<span class="string">&quot;beforeAdvice&quot;</span> pointcut-ref=<span class="string">&quot;myPointCut&quot;</span>&gt;&lt;/aop:before&gt;</span><br><span class="line">            &lt;aop:after method=<span class="string">&quot;afterAdvice&quot;</span> pointcut-ref=<span class="string">&quot;myPointCut&quot;</span>&gt;&lt;/aop:after&gt;</span><br><span class="line">        &lt;/aop:aspect&gt;</span><br><span class="line">    &lt;/aop:config&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Test类</span></span><br><span class="line"><span class="keyword">package</span> com.jackey.test;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.jackey.service.PeopleService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.support.ClassPathXmlApplicationContext;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApplicationContextTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * xml配置实现aop</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="type">ClassPathXmlApplicationContext</span> <span class="variable">applicationContext2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;applicationContext.xml&quot;</span>);</span><br><span class="line">        <span class="comment">//调用目标对象的方法</span></span><br><span class="line">        <span class="type">PeopleService</span> <span class="variable">bean</span> <span class="operator">=</span> applicationContext2.getBean(PeopleService.class);</span><br><span class="line">        bean.show1();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="配置详解"><a href="#配置详解" class="headerlink" title="配置详解"></a>配置详解</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723025252401-df104696-b906-4e7c-a475-c8525393a2f3.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723025732254-209b0177-fe1a-4196-89b1-049ed827c05b.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723029291513-729756db-29e7-44fd-b976-e53b022d7546.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723029517498-57675e89-f5f6-4364-898f-166186cd6e5c.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723029863184-1c87d239-3d5d-46e5-8a5b-437ee71fb60e.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723033797015-a7c6c65b-d559-4cb5-96cf-c1a87d74ce65.png"></p>
<h2 id="xml方式AOP的配置解析"><a href="#xml方式AOP的配置解析" class="headerlink" title="xml方式AOP的配置解析"></a>xml方式AOP的配置解析</h2><p><strong>首先进行自定义命名空间解析</strong></p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723036735421-2ede9e0e-682d-4beb-a452-9e4511ae8560.png"><br><strong>然后为标签制定一个解析器</strong></p>
<p><strong>parse解析器只做一件事，往Spring容器中注入一个</strong><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723036828755-8b99217b-2fdf-44c3-88b7-9582ae3d2773.png"><strong>，而它的本质是一个BeanPostProcessor，在对应的After方法中生成Bean的代理对象的动作，最终把代理对象存储到容器当中 简言之是一个生成AOP的Proxy的过程</strong></p>
<h2 id="AOP底层两种生成Proxy方式"><a href="#AOP底层两种生成Proxy方式" class="headerlink" title="AOP底层两种生成Proxy方式"></a>AOP底层两种生成Proxy方式</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723039051690-64e18ad7-2a35-4880-be60-d24d8f9cb37e.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723039120628-22296c9f-8d9b-45f0-b531-db990bc3c688.png"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723041123921-3314a490-7441-412d-a175-2693eab39945.png"></p>
<h3 id="jdk动态代理"><a href="#jdk动态代理" class="headerlink" title="jdk动态代理"></a>jdk动态代理</h3><p><strong>怎么理解jdk动态代理技术，目标类有接口，基于接口动态生成实现类的代理对象？</strong></p>
<p>JDK动态代理技术是Java中一种利用反射机制在运行时动态生成代理类的技术。它基于目标类实现的接口来创建代理对象，主要通过以下步骤实现：</p>
<ol>
<li><strong>定义接口</strong><strong>: 首先，你需要定义一个接口，这个接口是目标类实现的接口。例如：</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(String username)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(String username)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>编写目标类</strong><strong>: 编写实现了该接口的目标类，例如</strong><code>**UserServiceImpl**</code><strong>：</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Adding user: &quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteUser</span><span class="params">(String username)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Deleting user: &quot;</span> + username);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><strong>实现InvocationHandler接口</strong><strong>: 创建一个实现了</strong><code>**InvocationHandler**</code><strong>接口的类，这个类中实现代理对象的具体操作逻辑。例如：</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyInvocationHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyInvocationHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before method invocation&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;After method invocation&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li><strong>创建代理对象</strong><strong>: 使用</strong><code>**Proxy**</code><strong>类的</strong><code>**newProxyInstance**</code><strong>方法动态地创建代理对象。这个方法接受一个类加载器、一个接口数组和一个</strong><code>**InvocationHandler**</code><strong>实例作为参数，返回一个实现了指定接口的代理对象。例如：</strong></li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        <span class="type">InvocationHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyInvocationHandler</span>(userService);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">proxy</span> <span class="operator">=</span> (UserService) Proxy.newProxyInstance(</span><br><span class="line">                Main.class.getClassLoader(),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Class</span>[] &#123; UserService.class &#125;,</span><br><span class="line">                handler</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        proxy.addUser(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        proxy.deleteUser(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>在上述例子中，</strong><code>**Proxy.newProxyInstance**</code><strong>方法根据传入的接口数组和</strong><code>**InvocationHandler**</code><strong>实例动态地生成了一个实现了</strong><code>**UserService**</code><strong>接口的代理对象</strong><code>**proxy**</code><strong>。当调用</strong><code>**proxy**</code><strong>的方法时，实际会调用</strong><code>**MyInvocationHandler**</code><strong>中的</strong><code>**invoke**</code><strong>方法，在方法调用前后可以执行额外的逻辑，例如日志记录、权限检查等。</strong></p>
<p><strong>总结来说，JDK动态代理技术利用Java的反射机制，在运行时动态生成一个实现了指定接口的代理类对象，从而可以在方法调用前后插入一些通用逻辑，而不需要修改原始类的代码。</strong></p>
<p><strong>生成的 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;Proxy&lt;/font&gt;**</code></strong> 在某种意义上可以看作是 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;UserService&lt;/font&gt;**</code></strong> 接口的实现类。虽然它并不是你手动编写的典型意义上的实现类，但它确实实现了 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;UserService&lt;/font&gt;**</code></strong> 接口定义的所有方法。</strong></p>
<p><strong>在使用动态代理时，你通过 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;Proxy.newProxyInstance&lt;/font&gt;**</code></strong> 方法传入了一个接口数组和一个 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;InvocationHandler&lt;/font&gt;**</code></strong> 实例。Java 在运行时会动态生成一个代理类，这个代理类实现了这些接口，并且在方法调用时会委托给 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;InvocationHandler&lt;/font&gt;**</code></strong> 实现中的 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;invoke&lt;/font&gt;**</code></strong> 方法处理具体的逻辑。</strong></p>
<p>**因此，虽然在代码中你没有显式地编写一个类声明 **<code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;implements UserService&lt;/font&gt;**</code><strong>，但动态代理技术使得在运行时生成了一个实现了 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;UserService&lt;/font&gt;**</code></strong> 接口的类，这个类就是通过 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;Proxy.newProxyInstance&lt;/font&gt;**</code></strong> 生成的 <strong><code>**&lt;font style=&quot;color:rgb(36, 41, 47);background-color:rgb(244, 246, 248);&quot;&gt;Proxy&lt;/font&gt;**</code></strong> 对象。</strong></p>
<h3 id="Cglib动态代理"><a href="#Cglib动态代理" class="headerlink" title="Cglib动态代理"></a>Cglib动态代理</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.jackey.cglib;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.Enhancer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodInterceptor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cglib.proxy.MethodProxy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CglibTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//CGlib基于父类（目标类）生成Proxy</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//目标对象</span></span><br><span class="line">        <span class="type">Target</span> <span class="variable">target</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Target</span>();</span><br><span class="line">        <span class="comment">//通知对象</span></span><br><span class="line">        <span class="type">MyAdvice2</span> <span class="variable">myAdvice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyAdvice2</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//编写CGlib的代码</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建增强器对象</span></span><br><span class="line">        <span class="type">Enhancer</span> <span class="variable">enhancer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Enhancer</span>();</span><br><span class="line">        <span class="comment">//增强器设置父类</span></span><br><span class="line">        <span class="comment">//生成的代理对象就是Target的子类</span></span><br><span class="line">        enhancer.setSuperclass(Target.class);</span><br><span class="line">        <span class="comment">//设置回调</span></span><br><span class="line">        enhancer.setCallback(<span class="keyword">new</span> <span class="title class_">MethodInterceptor</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="comment">//intercept相当于jdk的Proxy的invoke方法</span></span><br><span class="line">            <span class="keyword">public</span> Object <span class="title function_">intercept</span><span class="params">(Object o, Method method, Object[] objects, MethodProxy methodProxy)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">                <span class="comment">//前置通知</span></span><br><span class="line">                myAdvice.beforeAdvice();</span><br><span class="line"></span><br><span class="line">                <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, objects);<span class="comment">//执行目标方法</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">//后置通知</span></span><br><span class="line">                myAdvice.afterAdvice();</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//生成代理对象</span></span><br><span class="line">        <span class="type">Target</span> <span class="variable">proxy</span> <span class="operator">=</span> (Target) enhancer.create();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//测试</span></span><br><span class="line">        proxy.show();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="基于注解配置的AOP"><a href="#基于注解配置的AOP" class="headerlink" title="基于注解配置的AOP"></a>基于注解配置的AOP</h1><h2 id="基本使用"><a href="#基本使用" class="headerlink" title="基本使用"></a>基本使用</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723088543986-2486cbe2-bfaf-4e17-bca4-32e240d993cc.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723088569853-76bbbf74-084c-48bc-bf0e-f6edec0013b4.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723088751160-177c62db-d80a-4cd5-b172-389c625f5824.png"><br>@Before属性时前置通知增强的目标对象方法的位置</p>
<h2 id="配置详解-1"><a href="#配置详解-1" class="headerlink" title="配置详解"></a>配置详解</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723088897910-df6013cc-f422-446e-85bc-9723eb5febfe.png"><br>切点表达式的抽取</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723089043223-f21f3684-bde8-49df-92cd-68c3b4d84510.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723089086906-06eacc38-8ed9-429a-b0ea-b90b66668c24.png"><br>配置核心配置类</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723099708731-0795a554-bcc8-4003-bbee-ec98aa775d43.png"><br>解析核心配置类，创建容器</p>
<h2 id="原理解析-Spring事务编程概述-基于xml声明式事务控制"><a href="#原理解析-Spring事务编程概述-基于xml声明式事务控制" class="headerlink" title="## 原理解析# Spring事务编程概述# 基于xml声明式事务控制"></a><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723099835095-17a64437-f0a6-4318-af3b-48c64746611f.png"><br>## 原理解析<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723100902257-08fc13cb-d662-4da9-a96e-bfad1f965e91.png"><br># Spring事务编程概述<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723101300135-72340fa2-5910-48d3-a709-303652c72e30.png"><br># 基于xml声明式事务控制<br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723112342005-3d43ae61-7a88-4690-8a21-097ac6084851.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723114372172-54f90e2d-3b93-4ecc-abf8-fa0eff27d11f.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723115161784-bd6ce760-b6d5-4039-8f27-9d6266882b96.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723113649775-ed7aafa5-593a-4e04-bdb2-7d8a7fbcb721.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723113728613-4a6326a7-f8d6-41f5-b4a5-075baa2b7353.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723113807929-3140dcb8-ce07-4782-b41a-c71e8a8d2d6a.png"></h2><p>以下内容尚未完善</p>
<h2 id="原理剖析-p99-？"><a href="#原理剖析-p99-？" class="headerlink" title="原理剖析 p99 ？"></a>原理剖析 p99 ？</h2><h1 id="基于注解声明式事务控制"><a href="#基于注解声明式事务控制" class="headerlink" title="基于注解声明式事务控制"></a>基于注解声明式事务控制</h1><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723114545844-925abdb4-c039-4d33-acbb-2630e6761e6f.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723114687462-25d42c20-d66e-46c2-ab9b-3aafbd777d60.png"><br>全注解配置：</p>
<p>将xml文件中的所有配置全部配置到核心类中</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723114935581-e45b19cf-8862-4d6e-b5da-1ada8318c5b1.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723115009567-3693b5bc-36fd-4119-8495-6a3fc9c60f43.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723115032610-33bbd462-4cc1-44c2-98fa-e82920aa1ad0.png"><br>更换解析方式</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723115099354-95d4a599-a5b3-4ab9-877f-ee79d046c637.png"></p>
<h1 id="Spring整合web环境"><a href="#Spring整合web环境" class="headerlink" title="Spring整合web环境"></a>Spring整合web环境</h1><h2 id="javaweb三大组件及环境特点"><a href="#javaweb三大组件及环境特点" class="headerlink" title="javaweb三大组件及环境特点"></a>javaweb三大组件及环境特点</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723119042672-3ba08fc2-5900-4678-b5c8-4690bb0807b1.png"></p>
<h2 id="Spring整合web环境的思路与实现"><a href="#Spring整合web环境的思路与实现" class="headerlink" title="Spring整合web环境的思路与实现"></a>Spring整合web环境的思路与实现</h2><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723119396848-400bf0b0-5ad5-4d72-acc1-e23ce452516c.png"><br><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring/1723120257638-73c77f13-cf40-46df-9ae2-5c7ccfcabe48.png"><br>contextInitialized监听Servlet Context域的创建</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/personal/avatar.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/personal/avatar.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">Arjen</div><div class="post-copyright__author_desc">Blog</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="http://example.com/2025/10/30/Framework-Spring/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('http://example.com/2025/10/30/Framework-Spring/')">Spring-框架</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="http://example.com/2025/10/30/Framework-Spring/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Spring-框架&amp;url=http://example.com/2025/10/30/Framework-Spring/&amp;pic=https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Arjen</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/Framework/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Framework<span class="tagsPageCount">1</span></a><a class="post-meta__box__tags" href="/tags/Spring/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>Spring<span class="tagsPageCount">1</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-full"><a href="/2025/10/29/Java-Proxy/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/JAVA/java.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java-动态代理,非侵入式编程的核心技术</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/personal/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2021/06/20/c0f1977daac9a.png" alt="status"/></div></div><div class="author-info__description">我不再将这个世界与我所期待,塑造的圆满世界比照,而是接受这个世界,爱它,属于它</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">Arjen</h1><div class="author-info__desc">Blog</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/Arjen-Ajie" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/371519548" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">在茫茫人海中,你找到了我~ Welcome,This is my world!</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/personal/tianjiaweixin.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/personal/erweima.png) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring%E6%A6%82%E8%BF%B0"><span class="toc-text">Spring概述</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BC%A0%E7%BB%9FJavaWeb%E5%BC%80%E5%8F%91%E5%9B%B0%E6%83%91%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="toc-text">传统JavaWeb开发困惑及解决方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IoC%E3%80%81DI%E5%92%8CAOP%E6%80%9D%E6%83%B3%E7%9A%84%E6%8F%90%E5%87%BA"><span class="toc-text">IoC、DI和AOP思想的提出</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IoC%E6%80%9D%E6%83%B3"><span class="toc-text">IoC思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DI%E6%80%9D%E6%83%B3"><span class="toc-text">DI思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#AOP%E6%80%9D%E6%83%B3"><span class="toc-text">AOP思想</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E6%A1%86%E6%9E%B6%E7%9A%84%E8%AF%9E%E7%94%9F"><span class="toc-text">Spring框架的诞生</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E6%A1%86%E6%9E%B6%E6%A6%82%E8%BF%B0"><span class="toc-text">Spring框架概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E5%8E%86%E5%8F%B2"><span class="toc-text">Spring历史</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring-Framework"><span class="toc-text">Spring Framework</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanFactory%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">BeanFactory快速入门</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E4%B8%80%E4%B8%AAbean%E5%AF%B9%E8%B1%A1%E8%AE%BE%E7%BD%AE%E5%88%B0bean%E5%B7%A5%E5%8E%82%E4%B8%AD"><span class="toc-text">将一个bean对象设置到bean工厂中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%86%E4%B8%80%E4%B8%AAbean%E5%AF%B9%E8%B1%A1%E8%AE%BE%E7%BD%AE%E5%88%B0%E5%8F%A6%E4%B8%80%E4%B8%AAbean%E4%B8%AD"><span class="toc-text">将一个bean对象设置到另一个bean中</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ApplicationContext%E5%BF%AB%E9%80%9F%E5%85%A5%E9%97%A8"><span class="toc-text">ApplicationContext快速入门</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanFactory%E4%B8%8EApplicationContext%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">BeanFactory与ApplicationContext的关系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanFactory%E7%9A%84%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB"><span class="toc-text">BeanFactory的继承体系</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ApplicationContext%E7%BB%A7%E6%89%BF%E4%BD%93%E7%B3%BB"><span class="toc-text">ApplicationContext继承体系</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Exml%E7%9A%84Spring%E5%BA%94%E7%94%A8"><span class="toc-text">基于xml的Spring应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBean%E7%9A%84%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-text">SpringBean的配置详解</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%9F%BA%E7%A1%80%E9%85%8D%E7%BD%AE"><span class="toc-text">Bean的基础配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%88%AB%E5%90%8D%E9%85%8D%E7%BD%AE"><span class="toc-text">Bean的别名配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E8%8C%83%E5%9B%B4%E8%AE%BE%E7%BD%AE"><span class="toc-text">Bean的范围设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%BB%B6%E8%BF%9F%E5%8A%A0%E8%BD%BD"><span class="toc-text">Bean的延迟加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%94%80%E6%AF%81%E6%96%B9%E6%B3%95"><span class="toc-text">Bean的初始化和销毁方法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-text">Spring实例化的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%9D%99%E6%80%81%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E5%AE%9E%E4%BE%8B%E5%8C%96Bean"><span class="toc-text">静态工厂方法实例化Bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E5%AE%9E%E4%BE%8B%E5%8C%96Bean"><span class="toc-text">实例工厂方法实例化Bean</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0FactoryBean%E8%A7%84%E8%8C%83%E5%BB%B6%E8%BF%9F%E5%AE%9E%E4%BE%8B%E5%8C%96Bean"><span class="toc-text">实现FactoryBean规范延迟实例化Bean</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E9%85%8D%E7%BD%AE"><span class="toc-text">Bean的依赖注入配置</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%9B%86%E5%90%88%E5%B1%9E%E6%80%A7%E6%B3%A8%E5%85%A5"><span class="toc-text">集合属性注入</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="toc-text">自动装配</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E7%9A%84%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E6%A0%87%E7%AD%BE"><span class="toc-text">Spring的其他配置标签</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E7%9A%84get%E6%96%B9%E6%B3%95"><span class="toc-text">Spring的get方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E9%85%8D%E7%BD%AE%E9%9D%9E%E8%87%AA%E5%AE%9A%E4%B9%89%E7%9A%84Bean"><span class="toc-text">Spring配置非自定义的Bean</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#DruidDatasource"><span class="toc-text">DruidDatasource</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Connection"><span class="toc-text">Connection</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SimpleDataFormat"><span class="toc-text">SimpleDataFormat</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#SqlSessionFactory"><span class="toc-text">SqlSessionFactory</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-text">Bean的实例化基本流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E7%9A%84%E5%90%8E%E5%A4%84%E7%90%86%E5%99%A8"><span class="toc-text">Spring的后处理器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanFactoryPostProcessor"><span class="toc-text">BeanFactoryPostProcessor</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9BeanDefinition"><span class="toc-text">修改BeanDefinition</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B3%A8%E5%86%8CBeanDefinition"><span class="toc-text">注册BeanDefinition</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%96%84Bean%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-text">完善Bean的实例化基本流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8Spring%E7%9A%84BeanDefinitionRegistryPostProcessor%E6%A1%88%E4%BE%8B"><span class="toc-text">使用Spring的BeanDefinitionRegistryPostProcessor案例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BeanPostProcessor"><span class="toc-text">BeanPostProcessor</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%86%8D%E5%AE%8C%E5%96%84Bean%E5%AE%9E%E4%BE%8B%E5%8C%96%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-text">再完善Bean实例化的基本流程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringBean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F"><span class="toc-text">SpringBean的生命周期</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bean%E7%9A%84%E5%AE%9E%E4%BE%8B%E5%B1%9E%E6%80%A7%E5%A1%AB%E5%85%85"><span class="toc-text">Bean的实例属性填充</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%89%E7%BA%A7%E7%BC%93%E5%AD%98"><span class="toc-text">三级缓存</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E7%9A%84Aware%E6%8E%A5%E5%8F%A3"><span class="toc-text">常用的Aware接口</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SpringIoC%E6%B5%81%E7%A8%8B%E6%80%BB%E7%BB%93"><span class="toc-text">SpringIoC流程总结</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%9FSpring-xml%E6%96%B9%E5%BC%8F%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6-%E6%95%B4%E5%90%88%E6%A8%A1%E5%BC%8F-P57-P66"><span class="toc-text">？Spring xml方式整合第三方框架(整合模式) P57-P66</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E6%95%B4%E5%90%88Mybatis"><span class="toc-text">Spring整合Mybatis</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Spring%E6%95%B4%E5%90%88MyBatis%E7%9A%84%E5%8E%9F%E7%90%86"><span class="toc-text">Spring整合MyBatis的原理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E7%9A%84Spring%E5%BA%94%E7%94%A8"><span class="toc-text">基于注解的Spring应用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E5%9F%BA%E6%9C%AC%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-text">Bean基本注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-text">Bean依赖注入注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E8%87%AA%E5%AE%9A%E4%B9%89Bean%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-text">非自定义Bean注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bean%E9%85%8D%E7%BD%AE%E7%B1%BB%E7%9A%84%E6%B3%A8%E8%A7%A3%E5%BC%80%E5%8F%91"><span class="toc-text">Bean配置类的注解开发</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E9%85%8D%E7%BD%AE%E5%85%B6%E4%BB%96%E6%B3%A8%E8%A7%A3"><span class="toc-text">Spring配置其他注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link"><span class="toc-text"></span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%9FSpring%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90-p76-79"><span class="toc-text">？Spring注解的原理解析 p76-79</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%EF%BC%9FSpring%E6%B3%A8%E8%A7%A3%E6%95%B4%E5%90%88%E7%AC%AC%E4%B8%89%E6%96%B9%E6%A1%86%E6%9E%B6-p80"><span class="toc-text">？Spring注解整合第三方框架 p80</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#AOP%E7%AE%80%E4%BB%8B"><span class="toc-text">AOP简介</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5"><span class="toc-text">AOP相关概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP%E6%80%9D%E6%83%B3%E5%AE%9E%E7%8E%B0%E7%9A%84%E6%96%B9%E6%A1%88"><span class="toc-text">AOP思想实现的方案</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A8%A1%E6%8B%9FAOP%E7%9A%84%E5%9F%BA%E7%A1%80%E4%BB%A3%E7%A0%81-%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">模拟AOP的基础代码(动态代理)</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8Exml%E9%85%8D%E7%BD%AE%E7%9A%84AOP"><span class="toc-text">基于xml配置的AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3"><span class="toc-text">配置详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#xml%E6%96%B9%E5%BC%8FAOP%E7%9A%84%E9%85%8D%E7%BD%AE%E8%A7%A3%E6%9E%90"><span class="toc-text">xml方式AOP的配置解析</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#AOP%E5%BA%95%E5%B1%82%E4%B8%A4%E7%A7%8D%E7%94%9F%E6%88%90Proxy%E6%96%B9%E5%BC%8F"><span class="toc-text">AOP底层两种生成Proxy方式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">jdk动态代理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Cglib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-text">Cglib动态代理</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E9%85%8D%E7%BD%AE%E7%9A%84AOP"><span class="toc-text">基于注解配置的AOP</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">基本使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E8%AF%A6%E8%A7%A3-1"><span class="toc-text">配置详解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E8%A7%A3%E6%9E%90-Spring%E4%BA%8B%E5%8A%A1%E7%BC%96%E7%A8%8B%E6%A6%82%E8%BF%B0-%E5%9F%BA%E4%BA%8Exml%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-text">## 原理解析# Spring事务编程概述# 基于xml声明式事务控制</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E7%90%86%E5%89%96%E6%9E%90-p99-%EF%BC%9F"><span class="toc-text">原理剖析 p99 ？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%9F%BA%E4%BA%8E%E6%B3%A8%E8%A7%A3%E5%A3%B0%E6%98%8E%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%8E%A7%E5%88%B6"><span class="toc-text">基于注解声明式事务控制</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spring%E6%95%B4%E5%90%88web%E7%8E%AF%E5%A2%83"><span class="toc-text">Spring整合web环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#javaweb%E4%B8%89%E5%A4%A7%E7%BB%84%E4%BB%B6%E5%8F%8A%E7%8E%AF%E5%A2%83%E7%89%B9%E7%82%B9"><span class="toc-text">javaweb三大组件及环境特点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spring%E6%95%B4%E5%90%88web%E7%8E%AF%E5%A2%83%E7%9A%84%E6%80%9D%E8%B7%AF%E4%B8%8E%E5%AE%9E%E7%8E%B0"><span class="toc-text">Spring整合web环境的思路与实现</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/30/Framework-Spring/" title="Spring-框架"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/Framework/Spring.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Spring-框架"/></a><div class="content"><a class="title" href="/2025/10/30/Framework-Spring/" title="Spring-框架">Spring-框架</a><time datetime="2025-10-30T02:12:41.000Z" title="发表于 2025-10-30 10:12:41">2025-10-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/29/Java-Proxy/" title="Java-动态代理,非侵入式编程的核心技术"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/JAVA/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java-动态代理,非侵入式编程的核心技术"/></a><div class="content"><a class="title" href="/2025/10/29/Java-Proxy/" title="Java-动态代理,非侵入式编程的核心技术">Java-动态代理,非侵入式编程的核心技术</a><time datetime="2025-10-29T07:46:11.000Z" title="发表于 2025-10-29 15:46:11">2025-10-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/29/Java-Reflection/" title="Java-反射"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/JAVA/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java-反射"/></a><div class="content"><a class="title" href="/2025/10/29/Java-Reflection/" title="Java-反射">Java-反射</a><time datetime="2025-10-29T07:45:13.000Z" title="发表于 2025-10-29 15:45:13">2025-10-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/16/Java-webSocket/" title="Java-WebSocket"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/JAVA/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java-WebSocket"/></a><div class="content"><a class="title" href="/2025/10/16/Java-webSocket/" title="Java-WebSocket">Java-WebSocket</a><time datetime="2025-10-16T01:33:54.000Z" title="发表于 2025-10-16 09:33:54">2025-10-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/10/16/Java-Thread2/" title="Java-Thread扩展"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://arjenblog-1339556015.cos.ap-beijing.myqcloud.com/docu/JAVA/java.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java-Thread扩展"/></a><div class="content"><a class="title" href="/2025/10/16/Java-Thread2/" title="Java-Thread扩展">Java-Thread扩展</a><time datetime="2025-10-16T01:08:03.000Z" title="发表于 2025-10-16 09:08:03">2025-10-16</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div id="workboard"><img class="workSituationImg boardsign" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/staticPic/shangban.png" alt="距离百万富翁也就还差中彩票啦~" title="距离百万富翁也就还差中彩票啦~"/><div id="runtimeTextTip"></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px" data-title="博客框架为Hexo_v5.4.0" title="博客框架为Hexo_v5.4.0"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Frame-Hexo.svg" alt="博客框架为Hexo_v5.4.0"/></a><a class="github-badge" target="_blank" href="https://blog.anheyu.com/" style="margin-inline:5px" data-title="本站使用AnZhiYu主题" title="本站使用AnZhiYu主题"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.9/img/Theme-AnZhiYu-2E67D3.svg" alt="本站使用AnZhiYu主题"/></a><a class="github-badge" target="_blank" href="https://www.dogecloud.com/" style="margin-inline:5px" data-title="本站使用多吉云为静态资源提供CDN加速" title="本站使用多吉云为静态资源提供CDN加速"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/CDN-多吉云-3693F3.svg" alt="本站使用多吉云为静态资源提供CDN加速"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px" data-title="本站项目由Github托管" title="本站项目由Github托管"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.1.5/img/badge/Source-Github.svg" alt="本站项目由Github托管"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px" data-title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可" title="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@2.2.0/img/badge/Copyright-BY-NC-SA.svg" alt="本站采用知识共享署名-非商业性使用-相同方式共享4.0国际许可协议进行许可"/></a></p></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2025 By <a class="footer-bar-link" href="/" title="Arjen" target="_blank">Arjen</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">16</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">18</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://earth.nullschool.net/zh-cn" title="earth"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="earth"/><span class="back-menu-item-text">earth</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://bongo.cat/" title="敲鼓喵"><img class="back-menu-item-icon" alt="敲鼓喵"/><span class="back-menu-item-text">敲鼓喵</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="https://drawafish.com/" title="DrawAFish"><img class="back-menu-item-icon" alt="DrawAFish"/><span class="back-menu-item-text">DrawAFish</span></a><a class="back-menu-item" href="/" title="陆续添加中..."><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="陆续添加中..."/><span class="back-menu-item-text">陆续添加中...</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="https://image.anheyu.com/" title="安知鱼图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://image.anheyu.com/favicon.ico" alt="安知鱼图床"/><span class="back-menu-item-text">安知鱼图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 全部</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 友链</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/music/?id=9586170740&amp;server=tencent"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/air-conditioner/"><i class="anzhiyufont anzhiyu-icon-fan faa-tada" style="font-size: 0.9em;"></i><span> 小空调</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/comments/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言板</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/API/" style="font-size: 0.88rem;">API<sup>1</sup></a><a href="/tags/Collection/" style="font-size: 0.88rem;">Collection<sup>1</sup></a><a href="/tags/Exception/" style="font-size: 0.88rem;">Exception<sup>1</sup></a><a href="/tags/File/" style="font-size: 0.88rem;">File<sup>1</sup></a><a href="/tags/Framework/" style="font-size: 0.88rem;">Framework<sup>1</sup></a><a href="/tags/IO/" style="font-size: 0.88rem;">IO<sup>1</sup></a><a href="/tags/JAVA/" style="font-size: 0.88rem; font-weight: 500; color: var(--anzhiyu-lighttext)">JAVA<sup>13</sup></a><a href="/tags/Lambda/" style="font-size: 0.88rem;">Lambda<sup>1</sup></a><a href="/tags/Spring/" style="font-size: 0.88rem;">Spring<sup>1</sup></a><a href="/tags/Stream/" style="font-size: 0.88rem;">Stream<sup>1</sup></a><a href="/tags/Thread/" style="font-size: 0.88rem;">Thread<sup>1</sup></a><a href="/tags/Thread%E6%89%A9%E5%B1%95/" style="font-size: 0.88rem;">Thread扩展<sup>1</sup></a><a href="/tags/%E4%B9%A6%E6%91%98/" style="font-size: 0.88rem;">书摘<sup>1</sup></a><a href="/tags/%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86/" style="font-size: 0.88rem;">动态代理<sup>1</sup></a><a href="/tags/%E5%8F%8D%E5%B0%84/" style="font-size: 0.88rem;">反射<sup>1</sup></a><a href="/tags/%E6%96%B9%E6%B3%95%E5%BC%95%E7%94%A8/" style="font-size: 0.88rem;">方法引用<sup>1</sup></a><a href="/tags/%E7%97%85%E9%9A%99%E7%A2%8E%E7%AC%94/" style="font-size: 0.88rem;">病隙碎笔<sup>1</sup></a><a href="/tags/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" style="font-size: 0.88rem;">网络编程<sup>1</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="9586170740" server="tencent" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/5934815007&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("09/10/2025 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2025 By 安知鱼 V1.6.14",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 Arjen 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script async="async">(function () {
  var grt = new Date("09/10/2025 00:00:00"); //设置网站上线时间
  var now = new Date();
  var dnum;
  var hnum;
  var mnum;
  var snum;
  var nowHour;

  // 计算并更新天数、小时数、分钟数和秒数
  function updateTime() {
    now = new Date(); // 更新 now 的值
    nowHour = now.getHours(); // 更新 nowHour 的值
    var days = (now - grt) / 1000 / 60 / 60 / 24;
    dnum = Math.floor(days);
    var hours = (now - grt) / 1000 / 60 / 60 - 24 * dnum;
    hnum = Math.floor(hours);
    if (String(hnum).length == 1) {
      hnum = "0" + hnum;
    }
    var minutes = (now - grt) / 1000 / 60 - 24 * 60 * dnum - 60 * hnum;
    mnum = Math.floor(minutes);
    if (String(mnum).length == 1) {
      mnum = "0" + mnum;
    }
    var seconds = (now - grt) / 1000 - 24 * 60 * 60 * dnum - 60 * 60 * hnum - 60 * mnum;
    snum = Math.round(seconds);
    if (String(snum).length == 1) {
      snum = "0" + snum;
    }
  }

  // 更新网页中显示的网站运行时间
  function updateHtml() {
    const footer = document.getElementById("footer");
    if (!footer) return
    let currentTimeHtml = "";
    if (nowHour < 18 && nowHour >= 9) {
      // 如果是上班时间，默认就是"安知鱼-上班摸鱼中.svg"图片，不需要更改
      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    } else {
      // 如果是下班时间，插入"安知鱼-下班啦.svg"图片
      let img = document.querySelector("#workboard .workSituationImg");
      if (img != null) {
        img.src = "/staticPic/xiaban.png";
        img.title = "下班了就该开开心心的玩耍~";
        img.alt = "下班了就该开开心心的玩耍~";
      }

      currentTimeHtml = `本站居然运行了 ${dnum} 天<span id='runtime'> ${hnum} 小时 ${mnum} 分 ${snum} 秒 </span><i class='anzhiyufont anzhiyu-icon-heartbeat' style='color:red'></i>`;
    }

    if (document.getElementById("runtimeTextTip")) {
      document.getElementById("runtimeTextTip").innerHTML = currentTimeHtml;
    }
  }

  setInterval(() => {
    updateTime();
    updateHtml();
  }, 1000);
})();</script><div class="js-pjax"><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://twikoo.arjen.fun/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://s4.zstatic.net/ajax/libs/twikoo/1.6.44/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://twikoo.arjen.fun/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://twikoo.arjen.fun/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://s4.zstatic.net/ajax/libs/twikoo/1.6.44/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://cdn.cbd.int/qrcodejs@1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/fireworks.min.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>